{"version":3,"file":"CesiumIonAuthPlugin-CIbO77mG.js","sources":["../../../src/core/plugins/auth/GoogleCloudAuth.js","../../../src/core/plugins/loaders/QuantizedMeshLoaderBase.js","../../../src/three/plugins/GoogleAttributionsManager.js","../../../src/three/plugins/GoogleCloudAuthPlugin.js","../../../src/three/plugins/loaders/QuantizedMeshLoader.js","../../../src/three/plugins/utilities/QuantizedMeshClipper.js","../../../src/three/plugins/QuantizedMeshPlugin.js","../../../src/three/plugins/CesiumIonAuthPlugin.js"],"sourcesContent":["import { TraversalUtils } from '3d-tiles-renderer/core';\n\nconst TILES_MAP_URL = 'https://tile.googleapis.com/v1/createSession';\n\n// Class for making fetches to Google Cloud, refreshing the token if needed.\n// Supports both the 2d map tiles API in addition to 3d tiles.\nexport class GoogleCloudAuth {\n\n\tget isMapTilesSession() {\n\n\t\treturn this.authURL === TILES_MAP_URL;\n\n\t}\n\n\tconstructor( options = {} ) {\n\n\t\tconst { apiToken, sessionOptions = null, autoRefreshToken = false } = options;\n\t\tthis.apiToken = apiToken;\n\t\tthis.autoRefreshToken = autoRefreshToken;\n\t\tthis.authURL = TILES_MAP_URL;\n\t\tthis.sessionToken = null;\n\t\tthis.sessionOptions = sessionOptions;\n\t\tthis._tokenRefreshPromise = null;\n\n\t}\n\n\tasync fetch( url, options ) {\n\n\t\t// if we're using a map tiles session then we have to refresh the token separately\n\t\tif ( this.sessionToken === null && this.isMapTilesSession ) {\n\n\t\t\tthis.refreshToken( options );\n\n\t\t}\n\n\t\tawait this._tokenRefreshPromise;\n\n\t\t// construct the url\n\t\tconst fetchUrl = new URL( url );\n\t\tfetchUrl.searchParams.set( 'key', this.apiToken );\n\t\tif ( this.sessionToken ) {\n\n\t\t\tfetchUrl.searchParams.set( 'session', this.sessionToken );\n\n\t\t}\n\n\t\t// try to refresh the session token if we failed to load it\n\t\tlet res = await fetch( fetchUrl, options );\n\t\tif ( res.status >= 400 && res.status <= 499 && this.autoRefreshToken ) {\n\n\t\t\t// refresh the session token\n\t\t\tawait this.refreshToken( options );\n\t\t\tif ( this.sessionToken ) {\n\n\t\t\t\tfetchUrl.searchParams.set( 'session', this.sessionToken );\n\n\t\t\t}\n\n\t\t\tres = await fetch( fetchUrl, options );\n\n\t\t}\n\n\t\tif ( this.sessionToken === null && ! this.isMapTilesSession ) {\n\n\t\t\t// if we're using a 3d tiles session then we get the session key in the first request\n\t\t\treturn res\n\t\t\t\t.json()\n\t\t\t\t.then( json => {\n\n\t\t\t\t\tthis.sessionToken = getSessionToken( json );\n\t\t\t\t\treturn json;\n\n\t\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn res;\n\n\t\t}\n\n\t}\n\n\trefreshToken( options ) {\n\n\t\tif ( this._tokenRefreshPromise === null ) {\n\n\t\t\t// construct the url to fetch the endpoint\n\t\t\tconst url = new URL( this.authURL );\n\t\t\turl.searchParams.set( 'key', this.apiToken );\n\n\t\t\t// initialize options for map tiles\n\t\t\tconst fetchOptions = { ...options };\n\t\t\tif ( this.isMapTilesSession ) {\n\n\t\t\t\tfetchOptions.method = 'POST';\n\t\t\t\tfetchOptions.body = JSON.stringify( this.sessionOptions );\n\t\t\t\tfetchOptions.headers = fetchOptions.headers || {};\n\t\t\t\tfetchOptions.headers = {\n\t\t\t\t\t...fetchOptions.headers,\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tthis._tokenRefreshPromise = fetch( url, fetchOptions )\n\t\t\t\t.then( res => {\n\n\t\t\t\t\tif ( ! res.ok ) {\n\n\t\t\t\t\t\tthrow new Error( `GoogleCloudAuth: Failed to load data with error code ${ res.status }` );\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn res.json();\n\n\t\t\t\t} )\n\t\t\t\t.then( json => {\n\n\t\t\t\t\tthis.sessionToken = getSessionToken( json );\n\t\t\t\t\tthis._tokenRefreshPromise = null;\n\n\t\t\t\t\treturn json;\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\treturn this._tokenRefreshPromise;\n\n\t}\n\n}\n\n// Takes a json response from the auth url and extracts the session token\nfunction getSessionToken( json ) {\n\n\tif ( 'session' in json ) {\n\n\t\t// if using the 2d maps api\n\t\treturn json.session;\n\n\t} else {\n\n\t\t// is using the 3d tiles api\n\t\tlet sessionToken = null;\n\t\tconst root = json.root;\n\t\tTraversalUtils.traverseSet( root, tile => {\n\n\t\t\tif ( tile.content && tile.content.uri ) {\n\n\t\t\t\tconst [ , params ] = tile.content.uri.split( '?' );\n\t\t\t\tsessionToken = new URLSearchParams( params ).get( 'session' );\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t\treturn false;\n\n\t\t} );\n\n\t\treturn sessionToken;\n\n\t}\n\n}\n\n","import { LoaderBase } from '3d-tiles-renderer/core';\n\nexport function zigZagDecode( value ) {\n\n\treturn ( value >> 1 ) ^ ( - ( value & 1 ) );\n\n}\n\nexport class QuantizedMeshLoaderBase extends LoaderBase {\n\n\tconstructor( ...args ) {\n\n\t\tsuper( ...args );\n\n\t\tthis.fetchOptions.header = {\n\t\t\tAccept: 'application/vnd.quantized-mesh,application/octet-stream;q=0.9',\n\t\t};\n\n\t}\n\n\tloadAsync( ...args ) {\n\n\t\tconst { fetchOptions } = this;\n\t\tfetchOptions.header = fetchOptions.header || {};\n\t\tfetchOptions.header[ 'Accept' ] = 'application/vnd.quantized-mesh,application/octet-stream;q=0.9';\n\t\tfetchOptions.header[ 'Accept' ] += ';extensions=octvertexnormals-watermask-metadata';\n\n\t\treturn super.loadAsync( ...args );\n\n\t}\n\n\tparse( buffer ) {\n\n\t\tlet pointer = 0;\n\t\tconst view = new DataView( buffer );\n\t\tconst readFloat64 = () => {\n\n\t\t\tconst result = view.getFloat64( pointer, true );\n\t\t\tpointer += 8;\n\t\t\treturn result;\n\n\t\t};\n\n\t\tconst readFloat32 = () => {\n\n\t\t\tconst result = view.getFloat32( pointer, true );\n\t\t\tpointer += 4;\n\t\t\treturn result;\n\n\t\t};\n\n\t\tconst readInt = () => {\n\n\t\t\tconst result = view.getUint32( pointer, true );\n\t\t\tpointer += 4;\n\t\t\treturn result;\n\n\t\t};\n\n\t\tconst readByte = () => {\n\n\t\t\tconst result = view.getUint8( pointer );\n\t\t\tpointer += 1;\n\t\t\treturn result;\n\n\t\t};\n\n\t\tconst readBuffer = ( count, type ) => {\n\n\t\t\tconst result = new type( buffer, pointer, count );\n\t\t\tpointer += count * type.BYTES_PER_ELEMENT;\n\t\t\treturn result;\n\n\t\t};\n\n\t\t// extract header\n\t\tconst header = {\n\t\t\tcenter: [ readFloat64(), readFloat64(), readFloat64() ],\n\t\t\tminHeight: readFloat32(),\n\t\t\tmaxHeight: readFloat32(),\n\t\t\tsphereCenter: [ readFloat64(), readFloat64(), readFloat64() ],\n\t\t\tsphereRadius: readFloat64(),\n\t\t\thorizonOcclusionPoint: [ readFloat64(), readFloat64(), readFloat64() ],\n\t\t};\n\n\t\t// extract vertex data\n\t\tconst vertexCount = readInt();\n\t\tconst uBuffer = readBuffer( vertexCount, Uint16Array );\n\t\tconst vBuffer = readBuffer( vertexCount, Uint16Array );\n\t\tconst hBuffer = readBuffer( vertexCount, Uint16Array );\n\n\t\tconst uResult = new Float32Array( vertexCount );\n\t\tconst vResult = new Float32Array( vertexCount );\n\t\tconst hResult = new Float32Array( vertexCount );\n\n\t\t// decode vertex data\n\t\tlet u = 0;\n\t\tlet v = 0;\n\t\tlet h = 0;\n\t\tconst MAX_VALUE = 32767;\n\t\tfor ( let i = 0; i < vertexCount; ++ i ) {\n\n\t\t\tu += zigZagDecode( uBuffer[ i ] );\n\t\t\tv += zigZagDecode( vBuffer[ i ] );\n\t\t\th += zigZagDecode( hBuffer[ i ] );\n\n\t\t\tuResult[ i ] = u / MAX_VALUE;\n\t\t\tvResult[ i ] = v / MAX_VALUE;\n\t\t\thResult[ i ] = h / MAX_VALUE;\n\n\t\t}\n\n\t\t// align pointer for index data\n\t\tconst is32 = vertexCount > 65536;\n\t\tconst bufferType = is32 ? Uint32Array : Uint16Array;\n\t\tif ( is32 ) {\n\n\t\t\tpointer = Math.ceil( pointer / 4 ) * 4;\n\n\t\t} else {\n\n\t\t\tpointer = Math.ceil( pointer / 2 ) * 2;\n\n\t\t}\n\n\t\t// extract index data\n\t\tconst triangleCount = readInt();\n\t\tconst indices = readBuffer( triangleCount * 3, bufferType );\n\n\t\t// decode the index data\n\t\tlet highest = 0;\n\t\tfor ( var i = 0; i < indices.length; ++ i ) {\n\n\t\t\tconst code = indices[ i ];\n\t\t\tindices[ i ] = highest - code;\n\t\t\tif ( code === 0 ) {\n\n\t\t\t\t++ highest;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// sort functions for the edges since they are not pre-sorted\n\t\tconst vSort = ( a, b ) => vResult[ b ] - vResult[ a ];\n\t\tconst vSortReverse = ( a, b ) => - vSort( a, b );\n\n\t\tconst uSort = ( a, b ) => uResult[ a ] - uResult[ b ];\n\t\tconst uSortReverse = ( a, b ) => - uSort( a, b );\n\n\t\t// get edge indices\n\t\tconst westVertexCount = readInt();\n\t\tconst westIndices = readBuffer( westVertexCount, bufferType );\n\t\twestIndices.sort( vSort );\n\n\t\tconst southVertexCount = readInt();\n\t\tconst southIndices = readBuffer( southVertexCount, bufferType );\n\t\tsouthIndices.sort( uSort );\n\n\t\tconst eastVertexCount = readInt();\n\t\tconst eastIndices = readBuffer( eastVertexCount, bufferType );\n\t\teastIndices.sort( vSortReverse );\n\n\t\tconst northVertexCount = readInt();\n\t\tconst northIndices = readBuffer( northVertexCount, bufferType );\n\t\tnorthIndices.sort( uSortReverse );\n\n\t\tconst edgeIndices = {\n\t\t\twestIndices,\n\t\t\tsouthIndices,\n\t\t\teastIndices,\n\t\t\tnorthIndices,\n\t\t};\n\n\t\t// parse extensions\n\t\tconst extensions = {};\n\t\twhile ( pointer < view.byteLength ) {\n\n\t\t\tconst extensionId = readByte();\n\t\t\tconst extensionLength = readInt();\n\n\t\t\tif ( extensionId === 1 ) {\n\n\t\t\t\t// oct encoded normals\n\t\t\t\tconst xy = readBuffer( vertexCount * 2, Uint8Array );\n\t\t\t\tconst normals = new Float32Array( vertexCount * 3 );\n\n\t\t\t\t// https://github.com/CesiumGS/cesium/blob/baaabaa49058067c855ad050be73a9cdfe9b6ac7/packages/engine/Source/Core/AttributeCompression.js#L119-L140\n\t\t\t\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\t\t\t\tlet x = ( xy[ 2 * i + 0 ] / 255 ) * 2 - 1;\n\t\t\t\t\tlet y = ( xy[ 2 * i + 1 ] / 255 ) * 2 - 1;\n\t\t\t\t\tconst z = 1.0 - ( Math.abs( x ) + Math.abs( y ) );\n\n\t\t\t\t\tif ( z < 0.0 ) {\n\n\t\t\t\t\t\tconst oldVX = x;\n\t\t\t\t\t\tx = ( 1.0 - Math.abs( y ) ) * signNotZero( oldVX );\n\t\t\t\t\t\ty = ( 1.0 - Math.abs( oldVX ) ) * signNotZero( y );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst len = Math.sqrt( x * x + y * y + z * z );\n\t\t\t\t\tnormals[ 3 * i + 0 ] = x / len;\n\t\t\t\t\tnormals[ 3 * i + 1 ] = y / len;\n\t\t\t\t\tnormals[ 3 * i + 2 ] = z / len;\n\n\t\t\t\t}\n\n\t\t\t\textensions[ 'octvertexnormals' ] = {\n\t\t\t\t\textensionId,\n\t\t\t\t\tnormals,\n\t\t\t\t};\n\n\t\t\t} else if ( extensionId === 2 ) {\n\n\t\t\t\t// water mask\n\t\t\t\tconst size = extensionLength === 1 ? 1 : 256;\n\t\t\t\tconst mask = readBuffer( size * size, Uint8Array );\n\t\t\t\textensions[ 'watermask' ] = {\n\t\t\t\t\textensionId,\n\t\t\t\t\tmask,\n\t\t\t\t\tsize,\n\t\t\t\t};\n\n\t\t\t} else if ( extensionId === 4 ) {\n\n\t\t\t\t// metadata\n\t\t\t\tconst jsonLength = readInt();\n\t\t\t\tconst jsonBuffer = readBuffer( jsonLength, Uint8Array );\n\t\t\t\tconst json = new TextDecoder().decode( jsonBuffer );\n\t\t\t\textensions[ 'metadata' ] = {\n\t\t\t\t\textensionId,\n\t\t\t\t\tjson: JSON.parse( json ),\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\t\t\theader,\n\t\t\tindices,\n\t\t\tvertexData: {\n\t\t\t\tu: uResult,\n\t\t\t\tv: vResult,\n\t\t\t\theight: hResult,\n\t\t\t},\n\t\t\tedgeIndices,\n\t\t\textensions,\n\t\t};\n\n\t}\n\n}\n\nfunction signNotZero( v ) {\n\n\treturn v < 0.0 ? - 1.0 : 1.0;\n\n}\n","export class GoogleAttributionsManager {\n\n\tconstructor() {\n\n\t\tthis.creditsCount = {};\n\n\t}\n\n\t_adjustAttributions( line, add ) {\n\n\t\tconst creditsCount = this.creditsCount;\n\t\tconst tokens = line.split( /;/g );\n\t\tfor ( let i = 0, l = tokens.length; i < l; i ++ ) {\n\n\t\t\tconst t = tokens[ i ];\n\t\t\tif ( ! ( t in creditsCount ) ) {\n\n\t\t\t\tcreditsCount[ t ] = 0;\n\n\t\t\t}\n\n\t\t\tcreditsCount[ t ] += add ? 1 : - 1;\n\n\t\t\tif ( creditsCount[ t ] <= 0 ) {\n\n\t\t\t\tdelete creditsCount[ t ];\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\taddAttributions( line ) {\n\n\t\tthis._adjustAttributions( line, true );\n\n\t}\n\n\tremoveAttributions( line ) {\n\n\t\tthis._adjustAttributions( line, false );\n\n\t}\n\n\ttoString() {\n\n\t\t// attribution guidelines: https://developers.google.com/maps/documentation/tile/create-renderer#display-attributions\n\n\t\tconst sortedByCount = Object.entries( this.creditsCount ).sort( ( a, b ) => {\n\n\t\t\tconst countA = a[ 1 ];\n\t\t\tconst countB = b[ 1 ];\n\t\t\treturn countB - countA; // Descending order\n\n\t\t} );\n\n\t\treturn sortedByCount.map( pair => pair[ 0 ] ).join( '; ' );\n\n\t}\n\n}\n","import { GoogleCloudAuth } from '3d-tiles-renderer/core/plugins';\nimport { GoogleAttributionsManager } from './GoogleAttributionsManager.js';\n\nconst TILES_3D_API = 'https://tile.googleapis.com/v1/3dtiles/root.json';\n\nexport class GoogleCloudAuthPlugin {\n\n\tconstructor( {\n\t\tapiToken,\n\t\tsessionOptions = null,\n\t\tautoRefreshToken = false,\n\t\tlogoUrl = null,\n\t\tuseRecommendedSettings = true,\n\t} ) {\n\n\t\tthis.name = 'GOOGLE_CLOUD_AUTH_PLUGIN';\n\n\t\tthis.apiToken = apiToken;\n\t\tthis.useRecommendedSettings = useRecommendedSettings;\n\t\tthis.logoUrl = logoUrl;\n\n\t\tthis.auth = new GoogleCloudAuth( { apiToken, autoRefreshToken, sessionOptions } );\n\t\tthis.tiles = null;\n\n\t\tthis._visibilityChangeCallback = null;\n\t\tthis._attributionsManager = new GoogleAttributionsManager();\n\t\tthis._logoAttribution = {\n\t\t\tvalue: '',\n\t\t\ttype: 'image',\n\t\t\tcollapsible: false,\n\t\t};\n\t\tthis._attribution = {\n\t\t\tvalue: '',\n\t\t\ttype: 'string',\n\t\t\tcollapsible: true,\n\t\t};\n\n\t}\n\n\tinit( tiles ) {\n\n\t\tconst { useRecommendedSettings, auth } = this;\n\n\t\t// reset the tiles in case this plugin was removed and re-added\n\t\ttiles.resetFailedTiles();\n\n\t\tif ( tiles.rootURL == null ) {\n\n\t\t\ttiles.rootURL = TILES_3D_API;\n\n\t\t}\n\n\t\tif ( ! auth.sessionOptions ) {\n\n\t\t\tauth.authURL = tiles.rootURL;\n\n\t\t}\n\n\t\tif ( useRecommendedSettings && ! auth.isMapTilesSession ) {\n\n\t\t\t// This plugin changes below values to be more efficient for the photorealistic tiles\n\t\t\ttiles.errorTarget = 20;\n\n\t\t}\n\n\t\tthis.tiles = tiles;\n\n\t\tthis._visibilityChangeCallback = ( { tile, visible } ) => {\n\n\t\t\tconst copyright = tile.cached.metadata?.asset?.copyright || '';\n\t\t\tif ( visible ) {\n\n\t\t\t\tthis._attributionsManager.addAttributions( copyright );\n\n\t\t\t} else {\n\n\t\t\t\tthis._attributionsManager.removeAttributions( copyright );\n\n\t\t\t}\n\n\t\t};\n\n\t\ttiles.addEventListener( 'tile-visibility-change', this._visibilityChangeCallback );\n\n\t}\n\n\tgetAttributions( target ) {\n\n\t\tif ( this.tiles.visibleTiles.size > 0 ) {\n\n\t\t\tif ( this.logoUrl ) {\n\n\t\t\t\tthis._logoAttribution.value = this.logoUrl;\n\t\t\t\ttarget.push( this._logoAttribution );\n\n\t\t\t}\n\n\t\t\tthis._attribution.value = this._attributionsManager.toString();\n\t\t\ttarget.push( this._attribution );\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.tiles.removeEventListener( 'tile-visibility-change', this._visibilityChangeCallback );\n\n\t}\n\n\tasync fetchData( uri, options ) {\n\n\t\treturn this.auth.fetch( uri, options );\n\n\t}\n\n}\n","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tDataTexture,\n\tDefaultLoadingManager,\n\tLinearFilter,\n\tLinearMipMapLinearFilter,\n\tMathUtils,\n\tMesh,\n\tMeshStandardMaterial,\n\tRGFormat,\n\tTriangle,\n\tUnsignedByteType,\n\tVector3,\n} from 'three';\nimport { QuantizedMeshLoaderBase } from '3d-tiles-renderer/core/plugins';\nimport { Ellipsoid } from '3d-tiles-renderer/three';\n\nconst _norm = /* @__PURE__ */ new Vector3();\nconst _tri = /* @__PURE__ */ new Triangle();\nconst _uvh = /* @__PURE__ */ new Vector3();\nconst _pos = /* @__PURE__ */ new Vector3();\nexport class QuantizedMeshLoader extends QuantizedMeshLoaderBase {\n\n\tconstructor( manager = DefaultLoadingManager ) {\n\n\t\tsuper();\n\t\tthis.manager = manager;\n\t\tthis.ellipsoid = new Ellipsoid();\n\t\tthis.skirtLength = 1000;\n\t\tthis.smoothSkirtNormals = true;\n\t\tthis.solid = false;\n\n\t\t// set the range of the tile\n\t\tthis.minLat = - Math.PI / 2;\n\t\tthis.maxLat = Math.PI / 2;\n\t\tthis.minLon = - Math.PI;\n\t\tthis.maxLon = Math.PI;\n\n\t}\n\n\tparse( buffer ) {\n\n\t\tconst {\n\t\t\tellipsoid,\n\t\t\tsolid,\n\t\t\tskirtLength,\n\t\t\tsmoothSkirtNormals,\n\n\t\t\tminLat,\n\t\t\tmaxLat,\n\t\t\tminLon,\n\t\t\tmaxLon,\n\t\t} = this;\n\n\t\tconst {\n\t\t\theader,\n\t\t\tindices,\n\t\t\tvertexData,\n\t\t\tedgeIndices,\n\t\t\textensions,\n\t\t} = super.parse( buffer );\n\n\t\tconst geometry = new BufferGeometry();\n\t\tconst material = new MeshStandardMaterial();\n\t\tconst mesh = new Mesh( geometry, material );\n\t\tmesh.position.set( ...header.center );\n\n\t\tconst includeNormals = 'octvertexnormals' in extensions;\n\t\tconst vertexCount = vertexData.u.length;\n\t\tconst positions = [];\n\t\tconst uvs = [];\n\t\tconst indexArr = [];\n\t\tconst normals = [];\n\t\tlet groupOffset = 0;\n\t\tlet materialIndex = 0;\n\n\t\t// construct terrain\n\t\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\t\treadUVHeight( i, _uvh );\n\t\t\treadPosition( _uvh.x, _uvh.y, _uvh.z, _pos );\n\n\t\t\tuvs.push( _uvh.x, _uvh.y );\n\t\t\tpositions.push( ..._pos );\n\n\t\t}\n\n\t\tfor ( let i = 0, l = indices.length; i < l; i ++ ) {\n\n\t\t\tindexArr.push( indices[ i ] );\n\n\t\t}\n\n\t\tif ( includeNormals ) {\n\n\t\t\tconst extNormals = extensions[ 'octvertexnormals' ].normals;\n\t\t\tfor ( let i = 0, l = extNormals.length; i < l; i ++ ) {\n\n\t\t\t\tnormals.push( extNormals[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// add material group\n\t\tgeometry.addGroup( groupOffset, indices.length, materialIndex );\n\t\tgroupOffset += indices.length;\n\t\tmaterialIndex ++;\n\n\t\t// create a lower cap\n\t\tif ( solid ) {\n\n\t\t\tconst indexOffset = positions.length / 3;\n\t\t\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\t\t\treadUVHeight( i, _uvh );\n\t\t\t\treadPosition( _uvh.x, _uvh.y, _uvh.z, _pos, - skirtLength );\n\n\t\t\t\tuvs.push( _uvh.x, _uvh.y );\n\t\t\t\tpositions.push( ..._pos );\n\n\t\t\t}\n\n\t\t\tfor ( let i = indices.length - 1; i >= 0; i -- ) {\n\n\t\t\t\tindexArr.push( indices[ i ] + indexOffset );\n\n\t\t\t}\n\n\t\t\tif ( includeNormals ) {\n\n\t\t\t\tconst extNormals = extensions[ 'octvertexnormals' ].normals;\n\t\t\t\tfor ( let i = 0, l = extNormals.length; i < l; i ++ ) {\n\n\t\t\t\t\tnormals.push( - extNormals[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\n\t\t\t// add material group\n\t\t\tgeometry.addGroup( groupOffset, indices.length, materialIndex );\n\t\t\tgroupOffset += indices.length;\n\t\t\tmaterialIndex ++;\n\n\t\t}\n\n\t\t// construct skirts\n\t\tif ( skirtLength > 0 ) {\n\n\t\t\tconst {\n\t\t\t\twestIndices,\n\t\t\t\teastIndices,\n\t\t\t\tsouthIndices,\n\t\t\t\tnorthIndices,\n\t\t\t} = edgeIndices;\n\n\t\t\t// construct the indices\n\t\t\tlet offset;\n\n\t\t\t// west\n\t\t\tconst westStrip = constructEdgeStrip( westIndices );\n\t\t\toffset = positions.length / 3;\n\t\t\tuvs.push( ...westStrip.uv );\n\t\t\tpositions.push( ...westStrip.positions );\n\t\t\tfor ( let i = 0, l = westStrip.indices.length; i < l; i ++ ) {\n\n\t\t\t\tindexArr.push( westStrip.indices[ i ] + offset );\n\n\t\t\t}\n\n\t\t\t// east\n\t\t\tconst eastStrip = constructEdgeStrip( eastIndices );\n\t\t\toffset = positions.length / 3;\n\t\t\tuvs.push( ...eastStrip.uv );\n\t\t\tpositions.push( ...eastStrip.positions );\n\t\t\tfor ( let i = 0, l = eastStrip.indices.length; i < l; i ++ ) {\n\n\t\t\t\tindexArr.push( eastStrip.indices[ i ] + offset );\n\n\t\t\t}\n\n\t\t\t// south\n\t\t\tconst southStrip = constructEdgeStrip( southIndices );\n\t\t\toffset = positions.length / 3;\n\t\t\tuvs.push( ...southStrip.uv );\n\t\t\tpositions.push( ...southStrip.positions );\n\t\t\tfor ( let i = 0, l = southStrip.indices.length; i < l; i ++ ) {\n\n\t\t\t\tindexArr.push( southStrip.indices[ i ] + offset );\n\n\t\t\t}\n\n\t\t\t// north\n\t\t\tconst northStrip = constructEdgeStrip( northIndices );\n\t\t\toffset = positions.length / 3;\n\t\t\tuvs.push( ...northStrip.uv );\n\t\t\tpositions.push( ...northStrip.positions );\n\t\t\tfor ( let i = 0, l = northStrip.indices.length; i < l; i ++ ) {\n\n\t\t\t\tindexArr.push( northStrip.indices[ i ] + offset );\n\n\t\t\t}\n\n\t\t\t// add the normals\n\t\t\tif ( includeNormals ) {\n\n\t\t\t\tnormals.push( ...westStrip.normals );\n\t\t\t\tnormals.push( ...eastStrip.normals );\n\t\t\t\tnormals.push( ...southStrip.normals );\n\t\t\t\tnormals.push( ...northStrip.normals );\n\n\t\t\t}\n\n\t\t\t// add material group\n\t\t\tgeometry.addGroup( groupOffset, indices.length, materialIndex );\n\t\t\tgroupOffset += indices.length;\n\t\t\tmaterialIndex ++;\n\n\t\t}\n\n\t\t// shift the positions by the center of the tile\n\t\tfor ( let i = 0, l = positions.length; i < l; i += 3 ) {\n\n\t\t\tpositions[ i + 0 ] -= header.center[ 0 ];\n\t\t\tpositions[ i + 1 ] -= header.center[ 1 ];\n\t\t\tpositions[ i + 2 ] -= header.center[ 2 ];\n\n\t\t}\n\n\t\t// generate geometry and mesh\n\t\tconst indexBuffer = positions.length / 3 > 65535 ? new Uint32Array( indexArr ) : new Uint16Array( indexArr );\n\t\tgeometry.setIndex( new BufferAttribute( indexBuffer, 1, false ) );\n\t\tgeometry.setAttribute( 'position', new BufferAttribute( new Float32Array( positions ), 3, false ) );\n\t\tgeometry.setAttribute( 'uv', new BufferAttribute( new Float32Array( uvs ), 2, false ) );\n\t\tif ( includeNormals ) {\n\n\t\t\tgeometry.setAttribute( 'normal', new BufferAttribute( new Float32Array( normals ), 3, false ) );\n\n\t\t}\n\n\t\t// generate the water texture\n\t\tif ( 'watermask' in extensions ) {\n\n\t\t\t// invert the mask data\n\t\t\t// TODO: this inversion step can be a bit slow\n\t\t\tconst { mask, size } = extensions[ 'watermask' ];\n\t\t\tconst maskBuffer = new Uint8Array( 2 * size * size );\n\t\t\tfor ( let i = 0, l = mask.length; i < l; i ++ ) {\n\n\t\t\t\tconst v = mask[ i ] === 255 ? 0 : 255;\n\t\t\t\tmaskBuffer[ 2 * i + 0 ] = v;\n\t\t\t\tmaskBuffer[ 2 * i + 1 ] = v;\n\n\t\t\t}\n\n\t\t\t// TODO: Luminance format is not supported - eventually node materials will\n\t\t\t// make it possible to map the texture to the appropriate buffer input.\n\t\t\tconst map = new DataTexture( maskBuffer, size, size, RGFormat, UnsignedByteType );\n\t\t\tmap.flipY = true;\n\t\t\tmap.minFilter = LinearMipMapLinearFilter;\n\t\t\tmap.magFilter = LinearFilter;\n\t\t\tmap.needsUpdate = true;\n\n\t\t\tmaterial.roughnessMap = map;\n\n\t\t}\n\n\t\t// set metadata\n\t\tmesh.userData.minHeight = header.minHeight;\n\t\tmesh.userData.maxHeight = header.maxHeight;\n\n\t\tif ( 'metadata' in extensions ) {\n\n\t\t\tmesh.userData.metadata = extensions[ 'metadata' ].json;\n\n\t\t}\n\n\t\treturn mesh;\n\n\t\tfunction readUVHeight( index, target ) {\n\n\t\t\ttarget.x = vertexData.u[ index ];\n\t\t\ttarget.y = vertexData.v[ index ];\n\t\t\ttarget.z = vertexData.height[ index ];\n\t\t\treturn target;\n\n\t\t}\n\n\t\tfunction readPosition( u, v, h, target, heightOffset = 0 ) {\n\n\t\t\tconst height = MathUtils.lerp( header.minHeight, header.maxHeight, h );\n\t\t\tconst lon = MathUtils.lerp( minLon, maxLon, u );\n\t\t\tconst lat = MathUtils.lerp( minLat, maxLat, v );\n\n\t\t\tellipsoid.getCartographicToPosition( lat, lon, height + heightOffset, target );\n\n\t\t\treturn target;\n\n\t\t}\n\n\t\tfunction constructEdgeStrip( indices ) {\n\n\t\t\tconst topUvs = [];\n\t\t\tconst topPos = [];\n\t\t\tconst botUvs = [];\n\t\t\tconst botPos = [];\n\t\t\tconst sideIndices = [];\n\t\t\tfor ( let i = 0, l = indices.length; i < l; i ++ ) {\n\n\t\t\t\treadUVHeight( indices[ i ], _uvh );\n\t\t\t\ttopUvs.push( _uvh.x, _uvh.y );\n\t\t\t\tbotUvs.push( _uvh.x, _uvh.y );\n\n\t\t\t\treadPosition( _uvh.x, _uvh.y, _uvh.z, _pos );\n\t\t\t\ttopPos.push( ..._pos );\n\n\t\t\t\treadPosition( _uvh.x, _uvh.y, _uvh.z, _pos, - skirtLength );\n\t\t\t\tbotPos.push( ..._pos );\n\n\t\t\t}\n\n\t\t\tconst triCount = ( indices.length - 1 );\n\t\t\tfor ( let i = 0; i < triCount; i ++ ) {\n\n\t\t\t\tconst t0 = i;\n\t\t\t\tconst t1 = i + 1;\n\t\t\t\tconst b0 = i + indices.length;\n\t\t\t\tconst b1 = i + indices.length + 1;\n\n\t\t\t\tsideIndices.push( t0, b0, t1 );\n\t\t\t\tsideIndices.push( t1, b0, b1 );\n\n\t\t\t}\n\n\t\t\tlet normals = null;\n\t\t\tif ( includeNormals ) {\n\n\t\t\t\tconst total = ( topPos.length + botPos.length ) / 3;\n\n\t\t\t\tif ( smoothSkirtNormals ) {\n\n\t\t\t\t\tnormals = new Array( total * 3 );\n\n\t\t\t\t\tconst extNormals = extensions[ 'octvertexnormals' ].normals;\n\t\t\t\t\tconst botOffset = normals.length / 2;\n\t\t\t\t\tfor ( let i = 0, l = total / 2; i < l; i ++ ) {\n\n\t\t\t\t\t\tconst index = indices[ i ];\n\t\t\t\t\t\tconst i3 = 3 * i;\n\t\t\t\t\t\tconst nx = extNormals[ 3 * index + 0 ];\n\t\t\t\t\t\tconst ny = extNormals[ 3 * index + 1 ];\n\t\t\t\t\t\tconst nz = extNormals[ 3 * index + 2 ];\n\n\t\t\t\t\t\tnormals[ i3 + 0 ] = nx;\n\t\t\t\t\t\tnormals[ i3 + 1 ] = ny;\n\t\t\t\t\t\tnormals[ i3 + 2 ] = nz;\n\n\t\t\t\t\t\tnormals[ botOffset + i3 + 0 ] = nx;\n\t\t\t\t\t\tnormals[ botOffset + i3 + 1 ] = ny;\n\t\t\t\t\t\tnormals[ botOffset + i3 + 2 ] = nz;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnormals = [];\n\t\t\t\t\t_tri.a.fromArray( topPos, 0 );\n\t\t\t\t\t_tri.b.fromArray( botPos, 0 );\n\t\t\t\t\t_tri.c.fromArray( topPos, 3 );\n\t\t\t\t\t_tri.getNormal( _norm );\n\n\t\t\t\t\tfor ( let i = 0; i < total; i ++ ) {\n\n\t\t\t\t\t\tnormals.push( ..._norm );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuv: [ ...topUvs, ...botUvs ],\n\t\t\t\tpositions: [ ...topPos, ...botPos ],\n\t\t\t\tindices: sideIndices,\n\t\t\t\tnormals,\n\t\t\t};\n\n\t\t}\n\n\t}\n\n}\n","import { MathUtils, Vector2, Vector3 } from 'three';\nimport { Ellipsoid } from '3d-tiles-renderer/three';\nimport { GeometryClipper, hashVertex } from './GeometryClipper.js';\n\nconst _cart = {};\nconst _vec = /* @__PURE__ */ new Vector3();\nconst _pos0 = /* @__PURE__ */ new Vector3();\nconst _pos1 = /* @__PURE__ */ new Vector3();\nconst _pos2 = /* @__PURE__ */ new Vector3();\nconst _pos3 = /* @__PURE__ */ new Vector3();\nconst _temp = /* @__PURE__ */ new Vector3();\nconst _temp2 = /* @__PURE__ */ new Vector3();\n\nconst _uv0 = /* @__PURE__ */ new Vector2();\nconst _uv1 = /* @__PURE__ */ new Vector2();\nconst _uv2 = /* @__PURE__ */ new Vector2();\n\nexport class QuantizedMeshClipper extends GeometryClipper {\n\n\tconstructor() {\n\n\t\tsuper();\n\t\tthis.ellipsoid = new Ellipsoid();\n\t\tthis.skirtLength = 1000;\n\t\tthis.smoothSkirtNormals = true;\n\t\tthis.solid = false;\n\n\t\tthis.minLat = - Math.PI / 2;\n\t\tthis.maxLat = Math.PI / 2;\n\t\tthis.minLon = - Math.PI;\n\t\tthis.maxLon = Math.PI;\n\n\t\tthis.attributeList = [ 'position', 'normal', 'uv' ];\n\n\t}\n\n\tclipToQuadrant( sourceMesh, left, bottom ) {\n\n\t\tconst { solid, skirtLength, ellipsoid, smoothSkirtNormals } = this;\n\n\t\tthis.clearSplitOperations();\n\t\tthis.addSplitOperation( getUvSplitOperation( 'x' ), ! left );\n\t\tthis.addSplitOperation( getUvSplitOperation( 'y' ), ! bottom );\n\n\t\tlet botResult, skirtResult;\n\t\tconst capGroup = sourceMesh.geometry.groups[ 0 ];\n\t\tconst capResult = this.getClippedData( sourceMesh, capGroup );\n\t\tthis.adjustVertices( capResult, sourceMesh.position, 0 );\n\n\t\tif ( solid ) {\n\n\t\t\tbotResult = {\n\t\t\t\tindex: capResult.index.slice().reverse(),\n\t\t\t\tattributes: {},\n\t\t\t};\n\n\t\t\tfor ( const key in capResult.attributes ) {\n\n\t\t\t\tbotResult.attributes[ key ] = capResult.attributes[ key ].slice();\n\n\t\t\t}\n\n\t\t\tconst normal = botResult.attributes.normal;\n\t\t\tif ( normal ) {\n\n\t\t\t\tfor ( let i = 0; i < normal.length; i += 3 ) {\n\n\t\t\t\t\tnormal[ i + 0 ] *= - 1;\n\t\t\t\t\tnormal[ i + 1 ] *= - 1;\n\t\t\t\t\tnormal[ i + 2 ] *= - 1;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.adjustVertices( botResult, sourceMesh.position, - skirtLength );\n\n\t\t}\n\n\t\tif ( skirtLength > 0 ) {\n\n\t\t\tskirtResult = {\n\t\t\t\tindex: [],\n\t\t\t\tattributes: {\n\t\t\t\t\tposition: [],\n\t\t\t\t\tnormal: [],\n\t\t\t\t\tuv: [],\n\t\t\t\t},\n\t\t\t};\n\n\t\t\t// push data onto the\n\t\t\tlet nextIndex = 0;\n\t\t\tconst vertToNewIndexMap = {};\n\t\t\tconst pushVertex = ( pos, uv, norm ) => {\n\n\t\t\t\tconst hash = hashVertex( ...pos, ...norm, ...uv );\n\t\t\t\tif ( ! ( hash in vertToNewIndexMap ) ) {\n\n\t\t\t\t\tvertToNewIndexMap[ hash ] = nextIndex;\n\t\t\t\t\tnextIndex ++;\n\n\t\t\t\t\tskirtResult.attributes.position.push( ...pos );\n\t\t\t\t\tskirtResult.attributes.normal.push( ...norm );\n\t\t\t\t\tskirtResult.attributes.uv.push( ...uv );\n\n\t\t\t\t}\n\n\t\t\t\tskirtResult.index.push( vertToNewIndexMap[ hash ] );\n\n\t\t\t};\n\n\t\t\t// TODO: this seems to have some problematic cases at the root tiles near the poles\n\t\t\tconst capIndex = capResult.index;\n\t\t\tconst capUv = capResult.attributes.uv;\n\t\t\tconst capPosition = capResult.attributes.position;\n\t\t\tconst capNormal = capResult.attributes.normal;\n\t\t\tconst capTriangles = capResult.index.length / 3;\n\t\t\tfor ( let i = 0; i < capTriangles; i ++ ) {\n\n\t\t\t\tconst triOffset = 3 * i;\n\t\t\t\tfor ( let e = 0; e < 3; e ++ ) {\n\n\t\t\t\t\tconst ne = ( e + 1 ) % 3;\n\t\t\t\t\tconst i0 = capIndex[ triOffset + e ];\n\t\t\t\t\tconst i1 = capIndex[ triOffset + ne ];\n\n\t\t\t\t\t_uv0.fromArray( capUv, i0 * 2 );\n\t\t\t\t\t_uv1.fromArray( capUv, i1 * 2 );\n\n\t\t\t\t\t// find the vertices that lie on the edge\n\t\t\t\t\tif (\n\t\t\t\t\t\t_uv0.x === _uv1.x && ( _uv0.x === 0 || _uv0.x === 0.5 || _uv0.x === 1.0 ) ||\n\t\t\t\t\t\t_uv0.y === _uv1.y && ( _uv0.y === 0 || _uv0.y === 0.5 || _uv0.y === 1.0 )\n\t\t\t\t\t) {\n\n\t\t\t\t\t\t_pos0.fromArray( capPosition, i0 * 3 );\n\t\t\t\t\t\t_pos1.fromArray( capPosition, i1 * 3 );\n\n\t\t\t\t\t\tconst u0 = _pos0;\n\t\t\t\t\t\tconst u1 = _pos1;\n\n\t\t\t\t\t\tconst b0 = _pos2.copy( _pos0 );\n\t\t\t\t\t\tconst b1 = _pos3.copy( _pos1 );\n\n\t\t\t\t\t\t_temp.copy( b0 ).add( sourceMesh.position );\n\t\t\t\t\t\tellipsoid.getPositionToNormal( _temp, _temp );\n\t\t\t\t\t\tb0.addScaledVector( _temp, - skirtLength );\n\n\t\t\t\t\t\t_temp.copy( b1 ).add( sourceMesh.position );\n\t\t\t\t\t\tellipsoid.getPositionToNormal( _temp, _temp );\n\t\t\t\t\t\tb1.addScaledVector( _temp, - skirtLength );\n\n\t\t\t\t\t\tif ( smoothSkirtNormals && capNormal ) {\n\n\t\t\t\t\t\t\t_temp.fromArray( capNormal, i0 * 3 );\n\t\t\t\t\t\t\t_temp2.fromArray( capNormal, i1 * 3 );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t_temp.subVectors( u0, u1 );\n\t\t\t\t\t\t\t_temp2.subVectors( u0, b0 ).cross( _temp ).normalize();\n\t\t\t\t\t\t\t_temp.copy( _temp2 );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpushVertex( u1, _uv1, _temp2 );\n\t\t\t\t\t\tpushVertex( u0, _uv0, _temp );\n\t\t\t\t\t\tpushVertex( b0, _uv0, _temp );\n\n\t\t\t\t\t\tpushVertex( u1, _uv1, _temp2 );\n\t\t\t\t\t\tpushVertex( b0, _uv0, _temp );\n\t\t\t\t\t\tpushVertex( b1, _uv1, _temp2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst capLength = capResult.index.length;\n\t\tconst result = capResult;\n\t\tif ( botResult ) {\n\n\t\t\tconst { index, attributes } = botResult;\n\t\t\tconst offset = result.attributes.position.length / 3;\n\t\t\tfor ( let i = 0, l = index.length; i < l; i ++ ) {\n\n\t\t\t\tresult.index.push( index[ i ] + offset );\n\n\t\t\t}\n\n\t\t\tfor ( const key in capResult.attributes ) {\n\n\t\t\t\tresult.attributes[ key ].push( ...attributes[ key ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( skirtResult ) {\n\n\t\t\tconst { index, attributes } = skirtResult;\n\t\t\tconst offset = result.attributes.position.length / 3;\n\t\t\tfor ( let i = 0, l = index.length; i < l; i ++ ) {\n\n\t\t\t\tresult.index.push( index[ i ] + offset );\n\n\t\t\t}\n\n\t\t\tfor ( const key in capResult.attributes ) {\n\n\t\t\t\tresult.attributes[ key ].push( ...attributes[ key ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// offset the uvs\n\t\tconst xUvOffset = left ? 0 : - 0.5;\n\t\tconst yUvOffset = bottom ? 0 : - 0.5;\n\t\tconst uv = result.attributes.uv;\n\t\tfor ( let i = 0, l = uv.length; i < l; i += 2 ) {\n\n\t\t\tuv[ i ] = ( uv[ i ] + xUvOffset ) * 2.0;\n\t\t\tuv[ i + 1 ] = ( uv[ i + 1 ] + yUvOffset ) * 2.0;\n\n\t\t}\n\n\t\t// construct the result\n\t\tconst resultMesh = this.constructMesh( result.attributes, result.index, sourceMesh );\n\t\tresultMesh.userData.minHeight = sourceMesh.userData.minHeight;\n\t\tresultMesh.userData.maxHeight = sourceMesh.userData.maxHeight;\n\n\t\tlet materialIndex = 0;\n\t\tlet start = 0;\n\t\tresultMesh.geometry.addGroup( start, capLength, materialIndex );\n\t\tstart += capLength;\n\t\tmaterialIndex ++;\n\n\t\tif ( botResult ) {\n\n\t\t\tresultMesh.geometry.addGroup( start, botResult.index.length, materialIndex );\n\t\t\tstart += botResult.index.length;\n\t\t\tmaterialIndex ++;\n\n\t\t}\n\n\t\tif ( skirtResult ) {\n\n\t\t\tresultMesh.geometry.addGroup( start, skirtResult.index.length, materialIndex );\n\t\t\tstart += skirtResult.index.length;\n\t\t\tmaterialIndex ++;\n\n\t\t}\n\n\t\treturn resultMesh;\n\n\t}\n\n\tadjustVertices( info, position, offset ) {\n\n\t\tconst { ellipsoid, minLat, maxLat, minLon, maxLon } = this;\n\t\tconst { attributes, vertexIsClipped } = info;\n\t\tconst posArr = attributes.position;\n\t\tconst uvArr = attributes.uv;\n\n\t\tconst vertexCount = posArr.length / 3;\n\t\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\t\tconst uv = _uv0.fromArray( uvArr, i * 2 );\n\t\t\tif ( vertexIsClipped && vertexIsClipped[ i ] ) {\n\n\t\t\t\tif ( Math.abs( uv.x - 0.5 ) < 1e-10 ) {\n\n\t\t\t\t\tuv.x = 0.5;\n\n\t\t\t\t}\n\n\t\t\t\tif ( Math.abs( uv.y - 0.5 ) < 1e-10 ) {\n\n\t\t\t\t\tuv.y = 0.5;\n\n\t\t\t\t}\n\n\t\t\t\t_uv0.toArray( uvArr, i * 2 );\n\n\t\t\t}\n\n\t\t\tconst lat = MathUtils.lerp( minLat, maxLat, uv.y );\n\t\t\tconst lon = MathUtils.lerp( minLon, maxLon, uv.x );\n\t\t\tconst point = _vec.fromArray( posArr, i * 3 ).add( position );\n\t\t\tellipsoid.getPositionToCartographic( point, _cart );\n\t\t\tellipsoid.getCartographicToPosition( lat, lon, _cart.height + offset, point );\n\t\t\tpoint.sub( position );\n\t\t\tpoint.toArray( posArr, i * 3 );\n\n\t\t}\n\n\t}\n\n}\n\nfunction getUvSplitOperation( axis ) {\n\n\treturn ( geometry, i0, i1, i2, barycoord ) => {\n\n\t\tconst uv = geometry.attributes.uv;\n\t\t_uv0.fromBufferAttribute( uv, i0 );\n\t\t_uv1.fromBufferAttribute( uv, i1 );\n\t\t_uv2.fromBufferAttribute( uv, i2 );\n\n\t\treturn _uv0[ axis ] * barycoord.x + _uv1[ axis ] * barycoord.y + _uv2[ axis ] * barycoord.z - 0.5;\n\n\t};\n\n}\n","import { Vector3 } from 'three';\nimport { QuantizedMeshLoader } from './loaders/QuantizedMeshLoader.js';\nimport { TilingScheme } from './images/utils/TilingScheme.js';\nimport { ProjectionScheme } from './images/utils/ProjectionScheme.js';\nimport { QuantizedMeshClipper } from './utilities/QuantizedMeshClipper.js';\n\nconst TILE_X = Symbol( 'TILE_X' );\nconst TILE_Y = Symbol( 'TILE_Y' );\nconst TILE_LEVEL = Symbol( 'TILE_LEVEL' );\nconst TILE_AVAILABLE = Symbol( 'TILE_AVAILABLE' );\n\n// We don't know the height ranges for the tile set on load so assume a large range and\n// adjust it once the tiles have actually loaded based on the min and max height\nconst INITIAL_HEIGHT_RANGE = 1e4;\nconst _vec = /* @__PURE__ */ new Vector3();\n\n// Checks if the given tile is available\nfunction isTileAvailable( available, level, x, y ) {\n\n\tif ( available && level < available.length ) {\n\n\t\t// TODO: consider a binary search\n\t\tconst availableSet = available[ level ];\n\t\tfor ( let i = 0, l = availableSet.length; i < l; i ++ ) {\n\n\t\t\tconst { startX, startY, endX, endY } = availableSet[ i ];\n\t\t\tif ( x >= startX && x <= endX && y >= startY && y <= endY ) {\n\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn false;\n\n}\n\n// Calculates the max level that can be loaded.\nfunction getMaxLevel( layer ) {\n\n\tconst { available = null, maxzoom = null } = layer;\n\treturn maxzoom === null ? available.length - 1 : maxzoom;\n\n}\n\n// Calculates whether metadata availability is present - returns -1 if not.\nfunction getMetadataAvailability( layer ) {\n\n\tconst { metadataAvailability = - 1 } = layer;\n\treturn metadataAvailability;\n\n}\n\n// Calculates whether the given tile should have metadata availability\nfunction getTileHasMetadata( tile, layer ) {\n\n\tconst level = tile[ TILE_LEVEL ];\n\tconst metadataAvailability = getMetadataAvailability( layer );\n\tconst maxLevel = getMaxLevel( layer );\n\n\treturn level < maxLevel && metadataAvailability !== - 1 && ( level % metadataAvailability ) === 0;\n\n}\n\n// Constructs the url for the given tile content\nfunction getContentUrl( x, y, level, version, layer ) {\n\n\treturn layer.tiles[ 0 ]\n\t\t.replace( /{\\s*z\\s*}/g, level )\n\t\t.replace( /{\\s*x\\s*}/g, x )\n\t\t.replace( /{\\s*y\\s*}/g, y )\n\t\t.replace( /{\\s*version\\s*}/g, version );\n\n}\n\nexport class QuantizedMeshPlugin {\n\n\tconstructor( options = {} ) {\n\n\t\tconst {\n\t\t\tuseRecommendedSettings = true,\n\t\t\tskirtLength = null,\n\t\t\tsmoothSkirtNormals = true,\n\t\t\tsolid = false,\n\t\t} = options;\n\n\t\t// plugin needs to run before other plugins that fetch data since content\n\t\t// is handled and loaded in a custom way\n\t\tthis.name = 'QUANTIZED_MESH_PLUGIN';\n\t\tthis.priority = - 1000;\n\n\t\tthis.tiles = null;\n\t\tthis.layer = null;\n\t\tthis.useRecommendedSettings = useRecommendedSettings;\n\t\tthis.skirtLength = skirtLength;\n\t\tthis.smoothSkirtNormals = smoothSkirtNormals;\n\t\tthis.solid = solid;\n\t\tthis.attribution = null;\n\n\t\tthis.tiling = new TilingScheme();\n\t\tthis.projection = new ProjectionScheme();\n\n\t}\n\n\t// Plugin function\n\tinit( tiles ) {\n\n\t\t// TODO: should we avoid setting this globally?\n\t\ttiles.fetchOptions.headers = tiles.fetchOptions.headers || {};\n\t\ttiles.fetchOptions.headers.Accept = 'application/vnd.quantized-mesh,application/octet-stream;q=0.9';\n\n\t\tif ( this.useRecommendedSettings ) {\n\n\t\t\ttiles.errorTarget = 2;\n\n\t\t}\n\n\t\tthis.tiles = tiles;\n\n\t}\n\n\tloadRootTileSet() {\n\n\t\tconst { tiles } = this;\n\n\t\t// initialize href to resolve the root in case it's specified as a relative url\n\t\tlet url = new URL( 'layer.json', new URL( tiles.rootURL, location.href ) );\n\t\ttiles.invokeAllPlugins( plugin => url = plugin.preprocessURL ? plugin.preprocessURL( url, null ) : url );\n\n\t\treturn tiles\n\t\t\t.invokeOnePlugin( plugin => plugin.fetchData && plugin.fetchData( url, this.tiles.fetchOptions ) )\n\t\t\t.then( res => res.json() )\n\t\t\t.then( json => {\n\n\t\t\t\tthis.layer = json;\n\t\t\t\tconst {\n\t\t\t\t\tprojection: layerProjection = 'EPSG:4326',\n\t\t\t\t\textensions = [],\n\t\t\t\t\tattribution = '',\n\t\t\t\t\tavailable = null,\n\t\t\t\t} = json;\n\n\t\t\t\tconst {\n\t\t\t\t\ttiling,\n\t\t\t\t\ttiles,\n\t\t\t\t\tprojection,\n\t\t\t\t} = this;\n\n\t\t\t\t// attribution\n\t\t\t\tif ( attribution ) {\n\n\t\t\t\t\tthis.attribution = {\n\t\t\t\t\t\tvalue: attribution,\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tcollapsible: true,\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\t// extensions\n\t\t\t\tif ( extensions.length > 0 ) {\n\n\t\t\t\t\ttiles.fetchOptions.headers[ 'Accept' ] += `;extensions=${ extensions.join( '-' ) }`;\n\n\t\t\t\t}\n\n\t\t\t\t// initialize tiling, projection\n\t\t\t\tprojection.setScheme( layerProjection );\n\n\t\t\t\tconst { tileCountX, tileCountY } = projection;\n\t\t\t\ttiling.setProjection( projection );\n\t\t\t\ttiling.generateLevels( getMaxLevel( json ) + 1, tileCountX, tileCountY );\n\n\t\t\t\t// initialize children\n\t\t\t\tconst children = [];\n\t\t\t\tfor ( let x = 0; x < tileCountX; x ++ ) {\n\n\t\t\t\t\tconst child = this.createChild( 0, x, 0, available );\n\t\t\t\t\tif ( child ) {\n\n\t\t\t\t\t\tchildren.push( child );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// produce the tile set root\n\t\t\t\tconst tileset = {\n\t\t\t\t\tasset: {\n\t\t\t\t\t\tversion: '1.1'\n\t\t\t\t\t},\n\t\t\t\t\tgeometricError: Infinity,\n\t\t\t\t\troot: {\n\t\t\t\t\t\trefine: 'REPLACE',\n\t\t\t\t\t\tgeometricError: Infinity,\n\t\t\t\t\t\tboundingVolume: {\n\t\t\t\t\t\t\tregion: [ ...this.tiling.getContentBounds(), - INITIAL_HEIGHT_RANGE, INITIAL_HEIGHT_RANGE ],\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: children,\n\n\t\t\t\t\t\t[ TILE_AVAILABLE ]: available,\n\t\t\t\t\t\t[ TILE_LEVEL ]: - 1,\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tlet baseUrl = tiles.rootURL;\n\t\t\t\ttiles.invokeAllPlugins( plugin => baseUrl = plugin.preprocessURL ? plugin.preprocessURL( baseUrl, null ) : baseUrl );\n\t\t\t\ttiles.preprocessTileSet( tileset, baseUrl );\n\n\t\t\t\treturn tileset;\n\n\t\t\t} );\n\n\t}\n\n\tparseToMesh( buffer, tile, extension, uri ) {\n\n\t\tconst {\n\t\t\tskirtLength,\n\t\t\tsolid,\n\t\t\tsmoothSkirtNormals,\n\t\t\ttiles,\n\t\t} = this;\n\n\t\t// set up loader\n\t\tconst ellipsoid = tiles.ellipsoid;\n\n\t\t// split the parent tile if needed\n\t\tlet result;\n\t\tif ( extension === 'quantized_tile_split' ) {\n\n\t\t\t// split the parent tile\n\t\t\tconst searchParams = new URL( uri ).searchParams;\n\t\t\tconst left = searchParams.get( 'left' ) === 'true';\n\t\t\tconst bottom = searchParams.get( 'bottom' ) === 'true';\n\n\t\t\t// parse the tile data\n\t\t\tconst clipper = new QuantizedMeshClipper();\n\t\t\tclipper.ellipsoid.copy( ellipsoid );\n\t\t\tclipper.solid = solid;\n\t\t\tclipper.smoothSkirtNormals = smoothSkirtNormals;\n\t\t\tclipper.skirtLength = skirtLength === null ? tile.geometricError : skirtLength;\n\n\t\t\tconst [ west, south, east, north ] = tile.parent.boundingVolume.region;\n\t\t\tclipper.minLat = south;\n\t\t\tclipper.maxLat = north;\n\t\t\tclipper.minLon = west;\n\t\t\tclipper.maxLon = east;\n\n\t\t\tresult = clipper.clipToQuadrant( tile.parent.cached.scene, left, bottom );\n\n\t\t} else if ( extension === 'terrain' ) {\n\n\t\t\tconst loader = new QuantizedMeshLoader( tiles.manager );\n\t\t\tloader.ellipsoid.copy( ellipsoid );\n\t\t\tloader.solid = solid;\n\t\t\tloader.smoothSkirtNormals = smoothSkirtNormals;\n\t\t\tloader.skirtLength = skirtLength === null ? tile.geometricError : skirtLength;\n\n\t\t\tconst [ west, south, east, north ] = tile.boundingVolume.region;\n\t\t\tloader.minLat = south;\n\t\t\tloader.maxLat = north;\n\t\t\tloader.minLon = west;\n\t\t\tloader.maxLon = east;\n\n\t\t\tresult = loader.parse( buffer );\n\n\t\t} else {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\t// adjust the bounding region to be more accurate based on the contents of the terrain file\n\t\t// NOTE: The debug region bounds are only created after the tile is first shown so the debug\n\t\t// region bounding volume will have the correct dimensions.\n\t\tconst { minHeight, maxHeight, metadata } = result.userData;\n\t\ttile.boundingVolume.region[ 4 ] = minHeight;\n\t\ttile.boundingVolume.region[ 5 ] = maxHeight;\n\t\ttile.cached.boundingVolume.setRegionData( ellipsoid, ...tile.boundingVolume.region );\n\n\t\t// use the geometric error value if it's present\n\t\tif ( metadata ) {\n\n\t\t\tif ( 'geometricerror' in metadata ) {\n\n\t\t\t\ttile.geometricError = metadata.geometricerror;\n\n\t\t\t}\n\n\t\t\t// if the tile hasn't been expanded yet and isn't in the queue to do so then\n\t\t\t// mark it for expansion again\n\t\t\tconst hasMetadata = getTileHasMetadata( tile, this.layer );\n\t\t\tif ( hasMetadata && 'available' in metadata && tile.children.length === 0 ) {\n\n\t\t\t\t// add an offset to account for the current and previous layers\n\t\t\t\ttile[ TILE_AVAILABLE ] = [\n\t\t\t\t\t...new Array( tile[ TILE_LEVEL ] + 1 ).fill( null ),\n\t\t\t\t\t...metadata.available,\n\t\t\t\t];\n\n\t\t\t}\n\n\t\t}\n\n\t\t// NOTE: we expand children only once the parent mesh data is loaded to ensure the mesh\n\t\t// data is ready for clipping. It's possible that this child data gets to the parse stage\n\t\t// first, otherwise, while the parent is still downloading.\n\t\t// Ideally we would be able to guarantee parents are loaded first but this is an odd case.\n\t\tthis.expandChildren( tile );\n\n\t\treturn result;\n\n\t}\n\n\tgetAttributions( target ) {\n\n\t\tif ( this.attribution ) {\n\n\t\t\ttarget.push( this.attribution );\n\n\t\t}\n\n\t}\n\n\t// Local functions\n\tcreateChild( level, x, y, available ) {\n\n\t\tconst { tiles, layer, tiling, projection } = this;\n\t\tconst ellipsoid = tiles.ellipsoid;\n\n\t\t// metadata availability will return \"null\" if there are no more children but we\n\t\t// have to always load the root tile data.\n\t\tconst isAvailable = available === null && level === 0 || isTileAvailable( available, level, x, y );\n\t\tconst url = getContentUrl( x, y, level, 1, layer );\n\t\tconst region = [ ...tiling.getTileBounds( x, y, level ), - INITIAL_HEIGHT_RANGE, INITIAL_HEIGHT_RANGE ];\n\t\tconst [ /* west */, south, /* east */, north, /* minHeight */, maxHeight ] = region;\n\t\tconst midLat = ( south > 0 ) !== ( north > 0 ) ? 0 : Math.min( Math.abs( south ), Math.abs( north ) );\n\n\t\t// get the projected perimeter\n\t\tellipsoid.getCartographicToPosition( midLat, 0, maxHeight, _vec );\n\t\t_vec.z = 0;\n\n\t\t// https://github.com/CesiumGS/cesium/blob/53889cbed2a91d38e0fae4b6f2dcf6783632fc92/packages/engine/Source/Scene/QuadtreeTileProvider.js#L24-L31\n\t\t// Implicit quantized mesh tile error halves with every layer\n\t\tconst tileCountX = projection.tileCountX;\n\t\tconst maxRadius = Math.max( ...ellipsoid.radius );\n\t\tconst rootGeometricError = maxRadius * 2 * Math.PI * 0.25 / ( 65 * tileCountX );\n\t\tconst geometricError = rootGeometricError / ( 2 ** level );\n\n\t\t// Create the child\n\t\tconst tile = {\n\t\t\t[ TILE_AVAILABLE ]: null,\n\t\t\t[ TILE_LEVEL ]: level,\n\t\t\t[ TILE_X ]: x,\n\t\t\t[ TILE_Y ]: y,\n\t\t\trefine: 'REPLACE',\n\t\t\tgeometricError: geometricError,\n\t\t\tboundingVolume: { region },\n\t\t\tcontent: isAvailable ? { uri: url } : null,\n\t\t\tchildren: []\n\t\t};\n\n\t\t// if we're relying on tile metadata availability then skip storing the tile metadata\n\t\tif ( ! getTileHasMetadata( tile, layer ) ) {\n\n\t\t\ttile[ TILE_AVAILABLE ] = available;\n\n\t\t}\n\n\t\treturn tile;\n\n\t}\n\n\texpandChildren( tile ) {\n\n\t\tconst level = tile[ TILE_LEVEL ];\n\t\tconst x = tile[ TILE_X ];\n\t\tconst y = tile[ TILE_Y ];\n\t\tconst available = tile[ TILE_AVAILABLE ];\n\n\t\t// only expand down to the highest level\n\t\tif ( level >= this.tiling.maxLevel ) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tlet hasChildren = false;\n\t\tfor ( let cx = 0; cx < 2; cx ++ ) {\n\n\t\t\tfor ( let cy = 0; cy < 2; cy ++ ) {\n\n\t\t\t\tconst child = this.createChild( level + 1, 2 * x + cx, 2 * y + cy, available );\n\t\t\t\tif ( child.content !== null ) {\n\n\t\t\t\t\ttile.children.push( child );\n\t\t\t\t\thasChildren = true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttile.children.push( child );\n\t\t\t\t\tchild.content = { uri: `tile.quantized_tile_split?bottom=${ cy === 0 }&left=${ cx === 0 }` };\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ! hasChildren ) {\n\n\t\t\ttile.children.length = 0;\n\n\t\t}\n\n\t}\n\n\tfetchData( uri, options ) {\n\n\t\t// if this is our custom url indicating a tile split then return fake response\n\t\tif ( /quantized_tile_split/.test( uri ) ) {\n\n\t\t\treturn new ArrayBuffer();\n\n\t\t}\n\n\t}\n\n\tdisposeTile( tile ) {\n\n\t\t// dispose of the available array since we will get it again if this tile is loaded\n\t\tif ( getTileHasMetadata( tile, this.layer ) ) {\n\n\t\t\ttile[ TILE_AVAILABLE ] = null;\n\n\t\t}\n\n\t\t// Note: we remove all children always because child tiles can rely on splitting parent tiles\n\t\t// and we can find ourselves in a situation where a child tile is ready first but the parent tile\n\t\t// hasn't loaded, causing a stall / race condition in the parsing queue. To avoid this dependency\n\t\t// we just remove all children and generate them again one the parent is loaded.\n\t\t// Only get rid of the children if this plugin was responsible for them.\n\t\tif ( TILE_AVAILABLE in tile ) {\n\n\t\t\ttile.children.forEach( child => {\n\n\t\t\t\t// TODO: there should be a reliable way for removing children like this.\n\t\t\t\tthis.tiles.processNodeQueue.remove( child );\n\n\t\t\t} );\n\t\t\ttile.children.length = 0;\n\t\t\ttile.__childrenProcessed = 0;\n\n\t\t}\n\n\t}\n\n}\n","import { CesiumIonAuth } from '3d-tiles-renderer/core/plugins';\nimport { GoogleCloudAuthPlugin } from './GoogleCloudAuthPlugin.js';\nimport { TMSTilesPlugin } from './images/EPSGTilesPlugin.js';\nimport { QuantizedMeshPlugin } from './QuantizedMeshPlugin.js';\n\nexport class CesiumIonAuthPlugin {\n\n\tget apiToken() {\n\n\t\treturn this.auth.apiToken;\n\n\t}\n\n\tset apiToken( v ) {\n\n\t\tthis.auth.apiToken = v;\n\n\t}\n\n\tget autoRefreshToken() {\n\n\t\treturn this.auth.autoRefreshToken;\n\n\t}\n\n\tset autoRefreshToken( v ) {\n\n\t\tthis.auth.autoRefreshToken = v;\n\n\t}\n\n\tconstructor( { apiToken, assetId = null, autoRefreshToken = false, useRecommendedSettings = true } ) {\n\n\t\tthis.name = 'CESIUM_ION_AUTH_PLUGIN';\n\t\tthis.auth = new CesiumIonAuth( { apiToken, autoRefreshToken } );\n\n\t\tthis.assetId = assetId;\n\t\tthis.autoRefreshToken = autoRefreshToken;\n\t\tthis.useRecommendedSettings = useRecommendedSettings;\n\t\tthis.tiles = null;\n\n\t\tthis._tileSetVersion = - 1;\n\t\tthis._attributions = [];\n\n\t}\n\n\tinit( tiles ) {\n\n\t\tif ( this.assetId !== null ) {\n\n\t\t\ttiles.rootURL = `https://api.cesium.com/v1/assets/${ this.assetId }/endpoint`;\n\n\t\t}\n\n\t\tthis.tiles = tiles;\n\t\tthis.auth.authURL = tiles.rootURL;\n\n\t\t// reset the tiles in case this plugin was removed and re-added\n\t\ttiles.resetFailedTiles();\n\n\t}\n\n\tloadRootTileSet() {\n\n\t\t// ensure we have an up-to-date token and root url, then trigger the internal\n\t\t// root tile set load function\n\t\treturn this\n\t\t\t.auth\n\t\t\t.refreshToken()\n\t\t\t.then( json => {\n\n\t\t\t\tthis._initializeFromAsset( json );\n\t\t\t\treturn this.tiles.invokeOnePlugin( plugin => plugin !== this && plugin.loadRootTileSet && plugin.loadRootTileSet() );\n\n\t\t\t} )\n\t\t\t.catch( error => {\n\n\t\t\t\tthis.tiles.dispatchEvent( {\n\t\t\t\t\ttype: 'load-error',\n\t\t\t\t\ttile: null,\n\t\t\t\t\terror,\n\t\t\t\t\turl: this.auth.authURL,\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t}\n\n\tpreprocessURL( uri ) {\n\n\t\turi = new URL( uri );\n\t\tif ( /^http/.test( uri.protocol ) && this._tileSetVersion != - 1 ) {\n\n\t\t\turi.searchParams.set( 'v', this._tileSetVersion );\n\n\t\t}\n\t\treturn uri.toString();\n\n\t}\n\n\tfetchData( uri, options ) {\n\n\t\tconst tiles = this.tiles;\n\t\tif ( tiles.getPluginByName( 'GOOGLE_CLOUD_AUTH_PLUGIN' ) !== null ) {\n\n\t\t\treturn null;\n\n\t\t} else {\n\n\t\t\treturn this.auth.fetch( uri, options );\n\n\t\t}\n\n\t}\n\n\tgetAttributions( target ) {\n\n\t\tif ( this.tiles.visibleTiles.size > 0 ) {\n\n\t\t\ttarget.push( ...this._attributions );\n\n\t\t}\n\n\t}\n\n\t_initializeFromAsset( json ) {\n\n\t\tconst tiles = this.tiles;\n\t\tif ( 'externalType' in json ) {\n\n\t\t\tconst url = new URL( json.options.url );\n\t\t\ttiles.rootURL = json.options.url;\n\n\t\t\t// if the tile set is \"external\" then assume it's a google API tile set\n\t\t\ttiles.registerPlugin( new GoogleCloudAuthPlugin( {\n\t\t\t\tapiToken: url.searchParams.get( 'key' ),\n\t\t\t\tautoRefreshToken: this.autoRefreshToken,\n\t\t\t\tuseRecommendedSettings: this.useRecommendedSettings,\n\t\t\t} ) );\n\n\t\t} else {\n\n\t\t\t// GLTF\n\t\t\t// CZML\n\t\t\t// KML\n\t\t\t// GEOJSON\n\t\t\tif ( json.type === 'TERRAIN' && tiles.getPluginByName( 'QUANTIZED_MESH_PLUGIN' ) === null ) {\n\n\t\t\t\ttiles.registerPlugin( new QuantizedMeshPlugin( {\n\t\t\t\t\tuseRecommendedSettings: this.useRecommendedSettings,\n\t\t\t\t} ) );\n\n\t\t\t} else if ( json.type === 'IMAGERY' && tiles.getPluginByName( 'TMS_TILES_PLUGIN' ) === null ) {\n\n\t\t\t\ttiles.registerPlugin( new TMSTilesPlugin( {\n\t\t\t\t\tuseRecommendedSettings: this.useRecommendedSettings,\n\t\t\t\t\tshape: 'ellipsoid',\n\t\t\t\t} ) );\n\n\t\t\t}\n\n\t\t\ttiles.rootURL = json.url;\n\n\t\t\t// save the version key if present\n\t\t\tconst url = new URL( json.url );\n\t\t\tif ( url.searchParams.has( 'v' ) && this._tileSetVersion === - 1 ) {\n\n\t\t\t\tthis._tileSetVersion = url.searchParams.get( 'v' );\n\n\t\t\t}\n\n\t\t\tif ( json.attributions ) {\n\n\t\t\t\tthis._attributions = json.attributions.map( att => ( {\n\t\t\t\t\tvalue: att.html,\n\t\t\t\t\ttype: 'html',\n\t\t\t\t\tcollapsible: att.collapsible,\n\t\t\t\t} ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n"],"names":["TILES_MAP_URL","GoogleCloudAuth","options","apiToken","sessionOptions","autoRefreshToken","url","fetchUrl","res","json","getSessionToken","fetchOptions","sessionToken","root","TraversalUtils.traverseSet","tile","params","zigZagDecode","value","QuantizedMeshLoaderBase","LoaderBase","args","buffer","pointer","view","readFloat64","result","readFloat32","readInt","readByte","readBuffer","count","type","header","vertexCount","uBuffer","vBuffer","hBuffer","uResult","vResult","hResult","u","v","h","MAX_VALUE","i","is32","bufferType","triangleCount","indices","highest","code","vSort","b","vSortReverse","uSort","uSortReverse","westVertexCount","westIndices","southVertexCount","southIndices","eastVertexCount","eastIndices","northVertexCount","northIndices","edgeIndices","extensions","extensionId","extensionLength","xy","normals","x","y","z","oldVX","signNotZero","len","size","mask","jsonLength","jsonBuffer","GoogleAttributionsManager","line","add","creditsCount","tokens","l","t","a","countA","pair","TILES_3D_API","GoogleCloudAuthPlugin","logoUrl","useRecommendedSettings","tiles","auth","visible","copyright","_b","_a","target","uri","_norm","Vector3","_tri","Triangle","_uvh","_pos","QuantizedMeshLoader","manager","DefaultLoadingManager","Ellipsoid","ellipsoid","solid","skirtLength","smoothSkirtNormals","minLat","maxLat","minLon","maxLon","vertexData","geometry","BufferGeometry","material","MeshStandardMaterial","mesh","Mesh","includeNormals","positions","uvs","indexArr","groupOffset","materialIndex","readUVHeight","readPosition","extNormals","indexOffset","offset","westStrip","constructEdgeStrip","eastStrip","southStrip","northStrip","indexBuffer","BufferAttribute","maskBuffer","map","DataTexture","RGFormat","UnsignedByteType","LinearMipMapLinearFilter","LinearFilter","index","heightOffset","height","MathUtils","lon","lat","topUvs","topPos","botUvs","botPos","sideIndices","triCount","t0","t1","b0","b1","total","botOffset","i3","nx","ny","nz","_cart","_vec","_pos0","_pos1","_pos2","_pos3","_temp","_temp2","_uv0","Vector2","_uv1","_uv2","QuantizedMeshClipper","GeometryClipper","sourceMesh","left","bottom","getUvSplitOperation","botResult","skirtResult","capGroup","capResult","key","normal","nextIndex","vertToNewIndexMap","pushVertex","pos","uv","norm","hash","hashVertex","capIndex","capUv","capPosition","capNormal","capTriangles","triOffset","e","ne","i0","i1","u0","u1","capLength","attributes","xUvOffset","yUvOffset","resultMesh","start","info","position","vertexIsClipped","posArr","uvArr","point","axis","i2","barycoord","TILE_X","TILE_Y","TILE_LEVEL","TILE_AVAILABLE","INITIAL_HEIGHT_RANGE","isTileAvailable","available","level","availableSet","startX","startY","endX","endY","getMaxLevel","layer","maxzoom","getMetadataAvailability","metadataAvailability","getTileHasMetadata","maxLevel","getContentUrl","version","QuantizedMeshPlugin","TilingScheme","ProjectionScheme","plugin","layerProjection","attribution","tiling","projection","tileCountX","tileCountY","children","child","tileset","baseUrl","extension","searchParams","clipper","west","south","east","north","loader","minHeight","maxHeight","metadata","isAvailable","region","midLat","geometricError","hasChildren","cx","cy","CesiumIonAuthPlugin","assetId","CesiumIonAuth","error","TMSTilesPlugin","att"],"mappings":"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"}