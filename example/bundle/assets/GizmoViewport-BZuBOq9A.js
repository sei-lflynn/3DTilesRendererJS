import{_ as v}from"./extends-CF3RwP-h.js";import{d as y,r as e,u as F,f as D}from"./CameraControls-CKhnPWYh.js";import{aE as Q,$ as X,z as A,aF as Y,a0 as V,S as Z,l as P,au as J,Q as H,k as K,aG as N}from"./three.module-D9WYbBBL.js";function U(n,g,l){const o=y(u=>u.size),s=y(u=>u.viewport),p=typeof n=="number"?n:o.width*s.dpr,i=o.height*s.dpr,r=(typeof n=="number"?l:n)||{},{samples:c=0,depth:m,...d}=r,h=m??r.depthBuffer,f=e.useMemo(()=>{const u=new Q(p,i,{minFilter:A,magFilter:A,type:X,...d});return h&&(u.depthTexture=new Y(p,i,V)),u.samples=c,u},[]);return e.useLayoutEffect(()=>{f.setSize(p,i),c&&(f.samples=c)},[c,f,p,i]),e.useEffect(()=>()=>f.dispose(),[]),f}const $=n=>typeof n=="function",ee=e.forwardRef(({envMap:n,resolution:g=256,frames:l=1/0,children:o,makeDefault:s,...p},i)=>{const r=y(({set:t})=>t),c=y(({camera:t})=>t),m=y(({size:t})=>t),d=e.useRef(null);e.useImperativeHandle(i,()=>d.current,[]);const h=e.useRef(null),f=U(g);e.useLayoutEffect(()=>{p.manual||d.current.updateProjectionMatrix()},[m,p]),e.useLayoutEffect(()=>{d.current.updateProjectionMatrix()}),e.useLayoutEffect(()=>{if(s){const t=c;return r(()=>({camera:d.current})),()=>r(()=>({camera:t}))}},[d,s,r]);let u=0,E=null;const a=$(o);return F(t=>{a&&(l===1/0||u<l)&&(h.current.visible=!1,t.gl.setRenderTarget(f),E=t.scene.background,n&&(t.scene.background=n),t.gl.render(t.scene,d.current),t.scene.background=E,t.gl.setRenderTarget(null),h.current.visible=!0,u++)}),e.createElement(e.Fragment,null,e.createElement("orthographicCamera",v({left:m.width/-2,right:m.width/2,top:m.height/2,bottom:m.height/-2,ref:d},p),!a&&o),e.createElement("group",{ref:h},a&&o(f.texture)))});function te({defaultScene:n,defaultCamera:g,renderPriority:l=1}){const{gl:o,scene:s,camera:p}=y();let i;return F(()=>{i=o.autoClear,l===1&&(o.autoClear=!0,o.render(n,g)),o.autoClear=!1,o.clearDepth(),o.render(s,p),o.autoClear=i},l),e.createElement("group",{onPointerOver:()=>null})}function ne({children:n,renderPriority:g=1}){const{scene:l,camera:o}=y(),[s]=e.useState(()=>new Z);return e.createElement(e.Fragment,null,D(e.createElement(e.Fragment,null,n,e.createElement(te,{defaultScene:l,defaultCamera:o,renderPriority:g})),s,{events:{priority:g+1}}))}const q=e.createContext({}),re=()=>e.useContext(q),oe=2*Math.PI,R=new J,I=new K,[C,M]=[new H,new H],G=new P,L=new P,ae=n=>"minPolarAngle"in n,k=n=>"getTarget"in n,ue=({alignment:n="bottom-right",margin:g=[80,80],renderPriority:l=1,onUpdate:o,onTarget:s,children:p})=>{const i=y(x=>x.size),r=y(x=>x.camera),c=y(x=>x.controls),m=y(x=>x.invalidate),d=e.useRef(null),h=e.useRef(null),f=e.useRef(!1),u=e.useRef(0),E=e.useRef(new P(0,0,0)),a=e.useRef(new P(0,0,0));e.useEffect(()=>{a.current.copy(r.up),R.up.copy(r.up)},[r]);const t=e.useCallback(x=>{f.current=!0,(c||s)&&(E.current=(s==null?void 0:s())||(k(c)?c.getTarget(E.current):c==null?void 0:c.target)),u.current=r.position.distanceTo(G),C.copy(r.quaternion),L.copy(x).multiplyScalar(u.current).add(G),R.lookAt(L),M.copy(R.quaternion),m()},[c,r,s,m]);F((x,b)=>{if(h.current&&d.current){var O;if(f.current)if(C.angleTo(M)<.01)f.current=!1,ae(c)&&r.up.copy(a.current);else{const B=b*oe;C.rotateTowards(M,B),r.position.set(0,0,1).applyQuaternion(C).multiplyScalar(u.current).add(E.current),r.up.set(0,1,0).applyQuaternion(C).normalize(),r.quaternion.copy(C),k(c)&&c.setPosition(r.position.x,r.position.y,r.position.z),o?o():c&&c.update(b),m()}I.copy(r.matrix).invert(),(O=d.current)==null||O.quaternion.setFromRotationMatrix(I)}});const W=e.useMemo(()=>({tweenCamera:t}),[t]),[z,T]=g,_=n.endsWith("-center")?0:n.endsWith("-left")?-i.width/2+z:i.width/2-z,j=n.startsWith("center-")?0:n.startsWith("top-")?i.height/2-T:-i.height/2+T;return e.createElement(ne,{renderPriority:l},e.createElement(q.Provider,{value:W},e.createElement(ee,{makeDefault:!0,ref:h,position:[0,0,200]}),e.createElement("group",{ref:d,position:[_,j,0]},p)))};function S({scale:n=[.8,.05,.05],color:g,rotation:l}){return e.createElement("group",{rotation:l},e.createElement("mesh",{position:[.4,0,0]},e.createElement("boxGeometry",{args:n}),e.createElement("meshBasicMaterial",{color:g,toneMapped:!1})))}function w({onClick:n,font:g,disabled:l,arcStyle:o,label:s,labelColor:p,axisHeadScale:i=1,...r}){const c=y(a=>a.gl),m=e.useMemo(()=>{const a=document.createElement("canvas");a.width=64,a.height=64;const t=a.getContext("2d");return t.beginPath(),t.arc(32,32,16,0,2*Math.PI),t.closePath(),t.fillStyle=o,t.fill(),s&&(t.font=g,t.textAlign="center",t.fillStyle=p,t.fillText(s,32,41)),new N(a)},[o,s,p,g]),[d,h]=e.useState(!1),f=(s?1:.75)*(d?1.2:1)*i,u=a=>{a.stopPropagation(),h(!0)},E=a=>{a.stopPropagation(),h(!1)};return e.createElement("sprite",v({scale:f,onPointerOver:l?void 0:u,onPointerOut:l?void 0:n||E},r),e.createElement("spriteMaterial",{map:m,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}const le=({hideNegativeAxes:n,hideAxisHeads:g,disabled:l,font:o="18px Inter var, Arial, sans-serif",axisColors:s=["#ff2060","#20df80","#2080ff"],axisHeadScale:p=1,axisScale:i,labels:r=["X","Y","Z"],labelColor:c="#000",onClick:m,...d})=>{const[h,f,u]=s,{tweenCamera:E}=re(),a={font:o,disabled:l,labelColor:c,onClick:m,axisHeadScale:p,onPointerDown:l?void 0:t=>{E(t.object.position),t.stopPropagation()}};return e.createElement("group",v({scale:40},d),e.createElement(S,{color:h,rotation:[0,0,0],scale:i}),e.createElement(S,{color:f,rotation:[0,0,Math.PI/2],scale:i}),e.createElement(S,{color:u,rotation:[0,-Math.PI/2,0],scale:i}),!g&&e.createElement(e.Fragment,null,e.createElement(w,v({arcStyle:h,position:[1,0,0],label:r[0]},a)),e.createElement(w,v({arcStyle:f,position:[0,1,0],label:r[1]},a)),e.createElement(w,v({arcStyle:u,position:[0,0,1],label:r[2]},a)),!n&&e.createElement(e.Fragment,null,e.createElement(w,v({arcStyle:h,position:[-1,0,0]},a)),e.createElement(w,v({arcStyle:f,position:[0,-1,0]},a)),e.createElement(w,v({arcStyle:u,position:[0,0,-1]},a)))))};export{ue as G,le as a,U as u};
//# sourceMappingURL=GizmoViewport-BZuBOq9A.js.map
