import{M as C,T as k,W as H,S as P,a as j,d as O,D as I,A as U}from"./three.module-D9WYbBBL.js";import{T as V}from"./TilesRenderer-DR8BxnJM.js";import{C as S}from"./Ellipsoid-DWeM2IpF.js";import{G as N}from"./GlobeControls-B_La97IP.js";import{E as q}from"./EnvironmentControls-CZh_wvzj.js";import{e as K}from"./GLTFLoader-CFPJuhhp.js";import{D as $}from"./DRACOLoader-BeOkl6yj.js";import{K as J}from"./KTX2Loader-0sMb_m5O.js";import{G as X}from"./GLTFExtensionsPlugin-DmHqh9g9.js";import"./I3DMLoader-BeHz4bWV.js";import"./BatchTable-CRr3zuRk.js";import"./B3DMLoader-Wj90IS9S.js";import"./PNTSLoader-Cu1RReYt.js";import"./CMPTLoader-1bsMlMtP.js";import"./EllipsoidRegion-BI1ZgYDb.js";const A="../data/tileset.json",z=document.getElementById("three-container"),W=document.getElementById("cesium-container"),p=z.getElementsByClassName("stats")[0],f=W.getElementsByClassName("stats")[0];let r,s,v=!1;(async()=>(await Y(),await Z(),window.addEventListener("keydown",e=>{e.key===" "&&document.body.classList.toggle("fullscreen")}),Q(),setInterval(()=>{const{camera:e}=s,{position:o,rotation:n}=e,a=[...o,n.x,n.y,n.z].map(t=>parseFloat(t.toFixed(4)));window.history.replaceState(void 0,void 0,`#${JSON.stringify(a)}`)},100),G()))();function Q(){const e=window.location.hash.replace(/^#/,"");if(!e)return;const[o,n,a,t,u,m]=JSON.parse(unescape(e)),{camera:i}=s;i.position.set(o,n,a),i.rotation.set(t,u,m),v=!0}function G(){requestAnimationFrame(G),window.THREE_DATA=s,window.CESIUM_DATA=r,s.update();const o=s.tiles.ellipsoid.getCartographicFromObjectFrame(s.camera.matrixWorld,{},S);r.camera.frustum.near=s.camera.near,r.camera.frustum.far=s.camera.far,r.camera.frustum.fov=ee(s.camera.fov,s.camera.aspect)*C.DEG2RAD,r.camera.position.x=s.camera.position.x,r.camera.position.y=s.camera.position.y,r.camera.position.z=s.camera.position.z,r.camera.setView({destination:r.position,orientation:{roll:o.roll,pitch:o.elevation,heading:o.azimuth}}),r.update();let n,a,t,u,m;a=0,u=0,m=0,s.tiles.forEachLoadedModel((i,d)=>{a++,i.traverse(y=>{const{geometry:E,material:B}=y;if(E){m+=K(y.geometry);for(const T in B){const g=B[T];if(g&&g.isTexture){const{format:_,type:F,image:R}=g,{width:w,height:L}=R;let l=k.getByteLength(w,L,_,F);l*=g.generateMipmaps?4/3:1,u+=l}}}})}),n=0,x(s.root,i=>{if(i.__hasRenderableContent&&i.__loadingState!==0)return n++,!0}),t=0,x(s.root,(i,d)=>{i.__hasContent&&i.__loadingState!==0&&t++}),b(p),c(p,"visible tiles",s.tiles.visibleTiles.size),c(p,"loaded tiles",t),c(p,"loaded geom tiles",a),c(p,"loaded subtree tiles",t-a),c(p,"loaded layer 1 tiles",n),c(p,"total memory",(s.tiles.lruCache.cachedBytes*1e-6).toFixed(3)+" MB"),c(p,"geometry memory",(m*1e-6).toFixed(3)+" MB"),c(p,"texture memory",(u*1e-6).toFixed(3)+" MB"),n=0,x(r.root,i=>{if(i._content&&i._content.ready&&i._content._model)return n++,!0}),t=0,m=0,u=0,x(r.root,(i,d)=>{i._content&&i._content.ready&&(d!==0&&t++,i._content._model&&(m+=i._content._model.statistics.geometryByteLength,u+=i._content._model.statistics.texturesByteLength))}),b(f),c(f,"visible tiles",r.tiles.statistics.selected),c(f,"loaded tiles",t),c(f,"loaded geom tiles",r.tiles.statistics.numberOfTilesWithContentReady),c(f,"loaded subtree tiles",t-r.tiles.statistics.numberOfTilesWithContentReady),c(f,"loaded layer 1 tiles",n),c(f,"total memory",(r.tiles.totalMemoryUsageInBytes*1e-6).toFixed(3)+" MB"),c(f,"geometry memory",(m*1e-6).toFixed(3)+" MB"),c(f,"texture memory",(u*1e-6).toFixed(3)+" MB")}async function Y(){const e=new H({antialias:!0});e.setClearColor(0),z.appendChild(e.domElement),e.domElement.style.imageRendering="pixelated",e.setPixelRatio(window.devicePixelRatio);const o=new P,n=window.innerWidth/window.innerHeight,a=60,t=new j(D(a,n),n,.1,1e10);t.position.set(-1.3567366495227425e6,529850286925096e-8,3.2711939085458643e6),t.quaternion.set(.27330445532852865,-.4460582045331912,-.821679716911258,.2262281938283491);const u=new $;u.setDecoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/draco/gltf/");const m=new J;m.setTranscoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/basis/"),m.detectSupport(e);const i=new V(A);i.registerPlugin(new X({rtc:!0,dracoLoader:u,ktxLoader:m})),i.preprocessURL=l=>unescape(l),i.lruCache.maxBytesSize=1/0,i.lruCache.minBytesSize=0,i.setResolutionFromRenderer(t,e),i.setCamera(t);let d;i.addEventListener("load-tile-set",()=>{const l=new O;if(i.getBoundingSphere(l),l.center.distanceTo(t.position)>l.radius*20&&(v=!1),!v){if(v=!0,t.position.copy(l.center),t.position.length()>1e5){const h=l.center.clone().normalize();t.position.addScaledVector(h,l.radius)}else t.position.x+=l.radius,t.position.y+=l.radius,t.position.z+=l.radius;t.lookAt(l.center)}d||(t.position.length()>1e5?(d=new N(o,t,e.domElement,null),d.enableDamping=!0,d.adjustHeight=!1,d.setEllipsoid(i.ellipsoid,i.group)):(d=new q(o,t,e.domElement,null),d.enableDamping=!0,d.adjustHeight=!1))}),o.add(i.group);const y=new I(16777215,2);y.position.set(1,2,3);const E=new U(16777215,1);o.add(y,E),i.ellipsoid.getObjectFrame(.5419733570174874,1.821470691863346,553.1228538149635,0,-.5000321680050197,0,t.matrixWorld,S).decompose(t.position,t.quaternion,t.scale),w(),window.addEventListener("resize",w,!1),s={tiles:i,camera:t,renderer:e,scene:o,update:L,get root(){return i.root}};function w(){const h=e.domElement,M=h.clientWidth/h.clientHeight;t.aspect=M,t.fov=D(60,M),t.updateProjectionMatrix(),e.setSize(h.clientWidth,h.clientHeight,!1)}function L(){w(),d&&d.update(),i.setResolutionFromRenderer(t,e),i.setCamera(t),t.updateMatrixWorld(),i.update(),e.render(o,t)}}async function Z(){const e=new Cesium.CesiumWidget(W);e.scene.terrainProvider=!1,e.scene.skyBox.destroy(),e.scene.skyBox=void 0,e.scene.sun.destroy(),e.scene.sun=void 0,e.scene.backgroundColor=Cesium.Color.BLACK.clone(),e.creditDisplay.container.style.display="none";const o=await Cesium.Cesium3DTileset.fromUrl(A,{maximumCacheOverflowBytes:1e20,cacheBytes:0});e.scene.primitives.add(o);const n=e.camera;r={tiles:o,viewer:e,camera:n,scene:e.scene,update:()=>{},get root(){let a=o._selectedTiles[0];for(;a&&a.parent;)a=a.parent;return a||null}}}function b(e){e.innerHTML=""}function c(e,o,n){e.innerHTML+=`<div name="${o}">${n}</div>`}function D(e,o){return C.RAD2DEG*2*Math.atan(Math.tan(C.DEG2RAD*e/2)/o)}function ee(e,o){return o<1?e:C.RAD2DEG*2*Math.atan(Math.tan(C.DEG2RAD*e/2)*o)}function x(e,o,n=0){e&&!o(e,n)&&e.children&&e.children.forEach(a=>{x(a,o,n+1)})}
//# sourceMappingURL=cesiumCompare-s_pTohh8.js.map
