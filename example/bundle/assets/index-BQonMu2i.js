import{l as xe,r as Ee,s as Te,S as Ce,W as j,a as q,t as Y,O as Se,D as Be,A as Pe,B as ke,d as Re,G as Z,R as Ae,V as ee,q as Le,h as le,u as Me,v as Ie}from"./three.module-D9WYbBBL.js";/* empty css               */import{T as De}from"./TilesRenderer-DR8BxnJM.js";import{L as Ue,r as He,a as Ke}from"./BatchTable-CRr3zuRk.js";import{G as Ve}from"./GLTFExtensionsPlugin-DmHqh9g9.js";import{D as M}from"./DebugTilesPlugin-1QoEHC55.js";import{O as Ne}from"./OrbitControls-DiOP3XKQ.js";import{e as Oe}from"./GLTFLoader-CFPJuhhp.js";import{D as ze}from"./DRACOLoader-BeOkl6yj.js";import{K as Fe}from"./KTX2Loader-0sMb_m5O.js";import{g as We}from"./lil-gui.module.min-BH_YJbPT.js";import{S as Ge}from"./stats.module--VATS4Kh.js";import"./I3DMLoader-BeHz4bWV.js";import"./Ellipsoid-DWeM2IpF.js";import"./B3DMLoader-Wj90IS9S.js";import"./PNTSLoader-Cu1RReYt.js";import"./CMPTLoader-1bsMlMtP.js";import"./EllipsoidRegion-BI1ZgYDb.js";import"./EllipsoidRegionHelper-0910Pngk.js";function $(d){return d.__implicitRoot.implicitTiling.subdivisionScheme==="OCTREE"}function X(d){return $(d)?8:4}function $e(d,e){if(!e)return[0,0,0];const i=2*e.__x+d.__subtreeIdx%2,t=2*e.__y+Math.floor(d.__subtreeIdx/2)%2,s=$(d)?2*e.__z+Math.floor(d.__subtreeIdx/4)%2:0;return[i,t,s]}class de{constructor(e,i){this.parent=e,this.children=[],this.__level=e.__level+1,this.__implicitRoot=e.__implicitRoot,this.__subtreeIdx=i,[this.__x,this.__y,this.__z]=$e(this,e)}static copy(e){const i={};return i.children=[],i.__level=e.__level,i.__implicitRoot=e.__implicitRoot,i.__subtreeIdx=e.__subtreeIdx,[i.__x,i.__y,i.__z]=[e.__x,e.__y,e.__z],i.boundingVolume=e.boundingVolume,i.geometricError=e.geometricError,i}}class je extends Ue{constructor(e){super(),this.tile=e,this.rootTile=e.__implicitRoot,this.workingPath=null}parseBuffer(e){const i=new DataView(e);let t=0;const s=He(i);console.assert(s==="subt",'SUBTREELoader: The magic bytes equal "subt".'),t+=4;const n=i.getUint32(t,!0);console.assert(n===1,'SUBTREELoader: The version listed in the header is "1".'),t+=4;const o=i.getUint32(t,!0);t+=8;const r=i.getUint32(t,!0);t+=8;const c=JSON.parse(Ke(new Uint8Array(e,t,o)));t+=o;const h=e.slice(t,t+r);return{version:n,subtreeJson:c,subtreeByte:h}}async parse(e){const i=this.parseBuffer(e),t=i.subtreeJson;t.contentAvailabilityHeaders=[].concat(t.contentAvailability);const s=this.preprocessBuffers(t.buffers),n=this.preprocessBufferViews(t.bufferViews,s);this.markActiveBufferViews(t,n);const o=await this.requestActiveBuffers(s,i.subtreeByte),r=this.parseActiveBufferViews(n,o);this.parseAvailability(i,t,r),this.expandSubtree(this.tile,i)}markActiveBufferViews(e,i){let t;const s=e.tileAvailability;isNaN(s.bitstream)?isNaN(s.bufferView)||(t=i[s.bufferView]):t=i[s.bitstream],t&&(t.isActive=!0,t.bufferHeader.isActive=!0);const n=e.contentAvailabilityHeaders;for(let r=0;r<n.length;r++)t=void 0,isNaN(n[r].bitstream)?isNaN(n[r].bufferView)||(t=i[n[r].bufferView]):t=i[n[r].bitstream],t&&(t.isActive=!0,t.bufferHeader.isActive=!0);t=void 0;const o=e.childSubtreeAvailability;isNaN(o.bitstream)?isNaN(o.bufferView)||(t=i[o.bufferView]):t=i[o.bitstream],t&&(t.isActive=!0,t.bufferHeader.isActive=!0)}async requestActiveBuffers(e,i){const t=[];for(let o=0;o<e.length;o++){const r=e[o];if(!r.isActive)t.push(Promise.resolve());else if(r.isExternal){const c=this.parseImplicitURIBuffer(this.tile,this.rootTile.implicitTiling.subtrees.uri,r.uri),h=fetch(c,this.fetchOptions).then(p=>{if(!p.ok)throw new Error(`SUBTREELoader: Failed to load external buffer from ${r.uri} with error code ${p.status}.`);return p.arrayBuffer()}).then(p=>new Uint8Array(p));t.push(h)}else t.push(Promise.resolve(new Uint8Array(i)))}const s=await Promise.all(t),n={};for(let o=0;o<s.length;o++){const r=s[o];r&&(n[o]=r)}return n}parseActiveBufferViews(e,i){const t={};for(let s=0;s<e.length;s++){const n=e[s];if(!n.isActive)continue;const o=n.byteOffset,r=o+n.byteLength,c=i[n.buffer];t[s]=c.slice(o,r)}return t}preprocessBuffers(e=[]){for(let i=0;i<e.length;i++){const t=e[i];t.isActive=!1,t.isExternal=!!t.uri}return e}preprocessBufferViews(e=[],i){for(let t=0;t<e.length;t++){const s=e[t];s.bufferHeader=i[s.buffer],s.isActive=!1,s.isExternal=s.bufferHeader.isExternal}return e}parseAvailability(e,i,t){const s=X(this.rootTile),n=this.rootTile.implicitTiling.subtreeLevels,o=(Math.pow(s,n)-1)/(s-1),r=Math.pow(s,n);e._tileAvailability=this.parseAvailabilityBitstream(i.tileAvailability,t,o),e._contentAvailabilityBitstreams=[];for(let c=0;c<i.contentAvailabilityHeaders.length;c++){const h=this.parseAvailabilityBitstream(i.contentAvailabilityHeaders[c],t,o);e._contentAvailabilityBitstreams.push(h)}e._childSubtreeAvailability=this.parseAvailabilityBitstream(i.childSubtreeAvailability,t,r)}parseAvailabilityBitstream(e,i,t){if(!isNaN(e.constant))return{constant:!!e.constant,lengthBits:t};let s;return isNaN(e.bitstream)?isNaN(e.bufferView)||(s=i[e.bufferView]):s=i[e.bitstream],{bitstream:s,lengthBits:t}}expandSubtree(e,i){const t=de.copy(e);for(let o=0;i&&o<i._contentAvailabilityBitstreams.length;o++)if(i&&this.getBit(i._contentAvailabilityBitstreams[o],0)){t.content={uri:this.parseImplicitURI(e,this.rootTile.content.uri)};break}e.children.push(t);const s=this.transcodeSubtreeTiles(t,i),n=this.listChildSubtrees(i,s);for(let o=0;o<n.length;o++){const r=n[o],c=r.tile,h=this.deriveChildTile(null,c,null,r.childMortonIndex);h.content={uri:this.parseImplicitURI(h,this.rootTile.implicitTiling.subtrees.uri)},c.children.push(h)}}transcodeSubtreeTiles(e,i){let t=[e],s=[];for(let n=1;n<this.rootTile.implicitTiling.subtreeLevels;n++){const o=X(this.rootTile),r=(Math.pow(o,n)-1)/(o-1),c=o*t.length;for(let h=0;h<c;h++){const p=r+h,E=h>>Math.log2(o),k=t[E];if(!this.getBit(i._tileAvailability,p)){s.push(void 0);continue}const I=this.deriveChildTile(i,k,p,h);k.children.push(I),s.push(I)}t=s,s=[]}return t}deriveChildTile(e,i,t,s){const n=new de(i,s);n.boundingVolume=this.getTileBoundingVolume(n),n.geometricError=this.getGeometricError(n);for(let o=0;e&&o<e._contentAvailabilityBitstreams.length;o++)if(e&&this.getBit(e._contentAvailabilityBitstreams[o],t)){n.content={uri:this.parseImplicitURI(n,this.rootTile.content.uri)};break}return n}getBit(e,i){if(i<0||i>=e.lengthBits)throw new Error("Bit index out of bounds.");if(e.constant!==void 0)return e.constant;const t=i>>3,s=i%8;return(new Uint8Array(e.bitstream)[t]>>s&1)===1}getTileBoundingVolume(e){const i={};if(this.rootTile.boundingVolume.region){const t=[...this.rootTile.boundingVolume.region],s=t[0],n=t[2],o=t[1],r=t[3],c=(n-s)/Math.pow(2,e.__level),h=(r-o)/Math.pow(2,e.__level);t[0]=s+c*e.__x,t[2]=s+c*(e.__x+1),t[1]=o+h*e.__y,t[3]=o+h*(e.__y+1);for(let p=0;p<4;p++){const E=t[p];E<-Math.PI?t[p]+=2*Math.PI:E>Math.PI&&(t[p]-=2*Math.PI)}if($(e)){const p=t[4],k=(t[5]-p)/Math.pow(2,e.__level);t[4]=p+k*e.__z,t[5]=p+k*(e.__z+1)}i.region=t}if(this.rootTile.boundingVolume.box){const t=[...this.rootTile.boundingVolume.box],s=2**e.__level-1,n=Math.pow(2,-e.__level),o=$(e)?3:2;for(let r=0;r<o;r++){t[3+r*3+0]*=n,t[3+r*3+1]*=n,t[3+r*3+2]*=n;const c=t[3+r*3+0],h=t[3+r*3+1],p=t[3+r*3+2],E=r===0?e.__x:r===1?e.__y:e.__z;t[0]+=2*c*(-.5*s+E),t[1]+=2*h*(-.5*s+E),t[2]+=2*p*(-.5*s+E)}i.box=t}return i}getGeometricError(e){return this.rootTile.geometricError/Math.pow(2,e.__level)}listChildSubtrees(e,i){const t=[],s=X(this.rootTile);for(let n=0;n<i.length;n++){const o=i[n];if(o!==void 0)for(let r=0;r<s;r++){const c=n*s+r;this.getBit(e._childSubtreeAvailability,c)&&t.push({tile:o,childMortonIndex:c})}}return t}parseImplicitURI(e,i){return i=i.replace("{level}",e.__level),i=i.replace("{x}",e.__x),i=i.replace("{y}",e.__y),i=i.replace("{z}",e.__z),i}parseImplicitURIBuffer(e,i,t){const s=this.parseImplicitURI(e,i),n=new URL(s,this.workingPath+"/");return n.pathname=n.pathname.substring(0,n.pathname.lastIndexOf("/")),new URL(n.pathname+"/"+t,this.workingPath+"/").toString()}}class qe{constructor(){this.name="IMPLICIT_TILING_PLUGIN"}init(e){this.tiles=e}preprocessNode(e,i,t){var s;e.implicitTiling?(e.__hasUnrenderableContent=!0,e.__hasRenderableContent=!1,e.__subtreeIdx=0,e.__implicitRoot=e,e.__x=0,e.__y=0,e.__z=0,e.__level=0):/.subtree$/i.test((s=e.content)==null?void 0:s.uri)&&(e.__hasUnrenderableContent=!0,e.__hasRenderableContent=!1)}parseTile(e,i,t){if(/^subtree$/i.test(t)){const s=new je(i);return s.workingPath=i.__basePath,s.fetchOptions=this.tiles.fetchOptions,s.parse(e)}}preprocessURL(e,i){if(i&&i.implicitTiling){const t=i.implicitTiling.subtrees.uri.replace("{level}",i.__level).replace("{x}",i.__x).replace("{y}",i.__y).replace("{z}",i.__z);return new URL(t,i.__basePath+"/").toString()}return e}disposeTile(e){var i;/.subtree$/i.test((i=e.content)==null?void 0:i.uri)&&(e.children.forEach(t=>{this.tiles.processNodeQueue.remove(t)}),e.children.length=0,e.__childrenProcessed=0)}}const Ye={type:"fly-change"},Ze={type:"fly-start"},Xe={type:"fly-end"},_=new Ee(0,0,0,0);class Q extends Ne{constructor(e,i){const t=y=>{this.enabled&&Object.defineProperty(y,"shiftKey",{get(){return!1}})};i.addEventListener("pointerdown",t),super(e,i),this.enableKeys=!1,this.enableFlight=!0,this.baseSpeed=1,this.fastSpeed=4,this.forwardKey="w",this.backKey="s",this.leftKey="a",this.rightKey="d",this.upKey="q",this.downKey="e",this.fastKey="shift";let s=!1,n=!1,o=!1,r=!1,c=!1,h=!1,p=!1,E=0,k=0,I=0,L=-1;const te=new xe,ie=new Te,se=()=>{if(L!==-1){cancelAnimationFrame(L),L=-1,this.minDistance=k,this.maxDistance=I;const y=Math.min(E,e.position.distanceTo(te));_.set(0,0,-1,0).applyMatrix4(e.matrixWorld),this.target.copy(e.position).addScaledVector(_,y),this.dispatchEvent(Xe)}},ne=()=>{if(!this.enabled||!this.enableFlight)return;L=requestAnimationFrame(ne),_.set(0,0,0,0),n&&(_.z-=1),o&&(_.z+=1),r&&(_.x-=1),c&&(_.x+=1),h&&(_.y+=1),p&&(_.y-=1),_.applyMatrix4(e.matrixWorld);const y=60*ie.getDelta(),R=s?this.fastSpeed:this.baseSpeed;e.position.addScaledVector(_,R*y),this.target.addScaledVector(_,R*y),this.dispatchEvent(Ye)},oe=y=>{const R=y.key.toLowerCase();switch(L===-1&&(I=this.maxDistance,k=this.minDistance,E=e.position.distanceTo(this.target),te.copy(this.target)),R){case this.forwardKey:n=!0;break;case this.backKey:o=!0;break;case this.leftKey:r=!0;break;case this.rightKey:c=!0;break;case this.upKey:h=!0;break;case this.downKey:p=!0;break;case this.fastKey:s=!0;break}switch(R){case this.fastKey:case this.forwardKey:case this.backKey:case this.leftKey:case this.rightKey:case this.upKey:case this.downKey:y.stopPropagation(),y.preventDefault()}(n||o||r||c||h||p||s)&&(this.minDistance=.01,this.maxDistance=.01,_.set(0,0,-1,0).applyMatrix4(e.matrixWorld),this.target.copy(e.position).addScaledVector(_,.01),L===-1&&(this.dispatchEvent(Ze),ie.getDelta(),ne()))},re=y=>{const R=y.key.toLowerCase();switch(R){case this.fastKey:case this.forwardKey:case this.backKey:case this.leftKey:case this.rightKey:case this.upKey:case this.downKey:y.stopPropagation(),y.preventDefault()}switch(R){case this.forwardKey:n=!1;break;case this.backKey:o=!1;break;case this.leftKey:r=!1;break;case this.rightKey:c=!1;break;case this.upKey:h=!1;break;case this.downKey:p=!1;break;case this.fastKey:s=!1;break}n||o||r||c||h||p||s||se()},ae=()=>{se()};this.blurCallback=ae,this.keyDownCallback=oe,this.keyUpCallback=re,this.disableShiftKeyCallback=t,this.domElement.addEventListener("blur",ae),this.domElement.addEventListener("keydown",oe),this.domElement.addEventListener("keyup",re)}dispose(){super.dispose(),this.domElement.removeEventListener("blur",this.blurCallback),this.domElement.removeEventListener("keydown",this.keyDownCallback),this.domElement.removeEventListener("keyup",this.keyUpCallback),this.domElement.removeEventListener("pointerdown",this.disableShiftKeyCallback)}}const me=0,Qe=1,be=2,ge=window.location.hash.replace(/^#/,""),N=new URLSearchParams(window.location.search);let m,D,C,f,l,U,B,x,O,u,H,z,w,b,K,W,J,P,S,g,V,A,T,v,G;const a={enableUpdate:!0,raycast:M.ColorModes.NONE,enableCacheDisplay:!1,enableRendererStats:!1,orthographic:!1,errorTarget:6,maxDepth:15,displayActiveTiles:!1,resolutionScale:1,up:N.get("up")??ge?"+Z":"+Y",enableDebug:!0,displayParentBounds:!1,displayBoxBounds:!1,displaySphereBounds:!1,displayRegionBounds:!1,colorMode:N.get("colorMode")in M.ColorModes?M.ColorModes[N.get("colorMode")]:M.ColorModes.NONE,unlit:!!N.get("unlit"),showThirdPerson:!1,showSecondView:!1,reload:we};Je();ve();function we(){const d=ge||"../data/tileset.json";l&&(T.remove(l.group),l.dispose());const e=new ze;e.setDecoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/draco/gltf/");const i=new Fe;i.setTranscoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/basis/"),i.detectSupport(f),l=new De(d),l.registerPlugin(new M),l.registerPlugin(new qe),l.registerPlugin(new Ve({rtc:!0,dracoLoader:e,ktxLoader:i})),l.fetchOptions.mode="cors",T.add(l.group),l.customColorCallback=(t,s)=>{const o=t.__depth%2===0?16711680:16777215;s.traverse(r=>{r.isMesh&&r.material.color.set(o)})}}function Je(){C=new Ce,f=new j({antialias:!0}),f.setPixelRatio(window.devicePixelRatio),f.setSize(window.innerWidth,window.innerHeight),f.setClearColor(1383455),document.body.appendChild(f.domElement),f.domElement.tabIndex=1,m=new q(60,window.innerWidth/window.innerHeight,1,1e4),m.position.set(400,400,400),U=new Y(m),C.add(U),b=new Se,K=new Y(b),C.add(K),w=new q(60,window.innerWidth/window.innerHeight,1,4e3),w.position.set(400,400,-400),w.lookAt(0,0,0),u=new j({antialias:!0}),u.setPixelRatio(window.devicePixelRatio),u.setSize(window.innerWidth,window.innerHeight),u.setClearColor(1383455),document.body.appendChild(u.domElement),u.domElement.style.position="absolute",u.domElement.style.right="0",u.domElement.style.top="0",u.domElement.style.outline="#0f1416 solid 2px",u.domElement.tabIndex=1,z=new Q(w,u.domElement),z.screenSpacePanning=!1,z.minDistance=1,z.maxDistance=5e3,H=new Y(w),C.add(H),B=new q(60,window.innerWidth/window.innerHeight,1,4e3),B.position.set(50,40,40),B.lookAt(0,0,0),x=new j({antialias:!0}),x.setPixelRatio(window.devicePixelRatio),x.setSize(window.innerWidth,window.innerHeight),x.setClearColor(988182),document.body.appendChild(x.domElement),x.domElement.style.position="fixed",x.domElement.style.left="5px",x.domElement.style.bottom="5px",x.domElement.tabIndex=1,O=new Q(B,x.domElement),O.screenSpacePanning=!1,O.minDistance=1,O.maxDistance=5e3,D=new Q(m,f.domElement),D.screenSpacePanning=!1,D.minDistance=1,D.maxDistance=5e3;const d=new Be(16777215,4);d.position.set(1,2,3),C.add(d);const e=new Pe(16777215,.2);C.add(e),W=new ke,J=new Re,A=new Z,C.add(A),T=new Z,A.add(T),P=new Ae,S=new ee,g=new Z;const i=new Le({color:15277667}),t=new le(new Me(.25,.25,6),i);t.rotation.x=Math.PI/2,t.position.z+=3,g.add(t);const s=new le(new Ie(1.5,.2,16,100),i);g.add(s),C.add(g),g.visible=!1,we(),F(),window.addEventListener("resize",F,!1),f.domElement.addEventListener("pointermove",he,!1),f.domElement.addEventListener("pointerdown",ue,!1),f.domElement.addEventListener("pointerup",fe,!1),f.domElement.addEventListener("pointerleave",ce,!1),u.domElement.addEventListener("pointermove",he,!1),u.domElement.addEventListener("pointerdown",ue,!1),u.domElement.addEventListener("pointerup",fe,!1),u.domElement.addEventListener("pointerleave",ce,!1);const n=new We;n.width=300;const o=n.addFolder("Tiles Options");o.add(a,"displayActiveTiles"),o.add(a,"errorTarget").min(0).max(50),o.add(a,"maxDepth").min(1).max(100),o.add(a,"up",["+Y","+Z","-Z"]),o.open();const r=n.addFolder("Debug Options");r.add(a,"enableDebug"),r.add(a,"displayParentBounds"),r.add(a,"displayBoxBounds"),r.add(a,"displaySphereBounds"),r.add(a,"displayRegionBounds"),r.add(a,"colorMode",M.ColorModes),r.add(a,"unlit"),r.open();const c=n.addFolder("Example Options");c.add(a,"resolutionScale").min(.01).max(2).step(.01).onChange(F),c.add(a,"orthographic"),c.add(a,"showThirdPerson"),c.add(a,"showSecondView").onChange(F),c.add(a,"enableUpdate").onChange(h=>{l.parseQueue.autoUpdate=h,l.downloadQueue.autoUpdate=h,h&&(l.parseQueue.scheduleJobRun(),l.downloadQueue.scheduleJobRun())}),c.add(a,"raycast",{NONE:me,ALL_HITS:Qe,FIRST_HIT_ONLY:be}),c.add(a,"enableCacheDisplay"),c.add(a,"enableRendererStats"),c.open(),n.add(a,"reload"),n.open(),v=document.createElement("div"),v.style.position="absolute",v.style.top=0,v.style.left=0,v.style.color="white",v.style.width="100%",v.style.textAlign="center",v.style.padding="5px",v.style.pointerEvents="none",v.style.lineHeight="1.5em",document.body.appendChild(v),G=new Ge,G.showPanel(0),document.body.appendChild(G.dom)}function F(){B.aspect=window.innerWidth/window.innerHeight,B.updateProjectionMatrix(),x.setSize(Math.floor(window.innerWidth/3),Math.floor(window.innerHeight/3)),a.showSecondView?(m.aspect=.5*window.innerWidth/window.innerHeight,f.setSize(.5*window.innerWidth,window.innerHeight),w.aspect=.5*window.innerWidth/window.innerHeight,u.setSize(.5*window.innerWidth,window.innerHeight),u.domElement.style.display="block"):(m.aspect=window.innerWidth/window.innerHeight,f.setSize(window.innerWidth,window.innerHeight),u.domElement.style.display="none"),m.updateProjectionMatrix(),f.setPixelRatio(window.devicePixelRatio*a.resolutionScale),w.updateProjectionMatrix(),u.setPixelRatio(window.devicePixelRatio),_e()}function ce(d){V=null}function he(d){const e=this.getBoundingClientRect();S.x=d.clientX-e.x,S.y=d.clientY-e.y,S.x=S.x/e.width*2-1,S.y=-(S.y/e.height)*2+1,V=this}const ye=new ee,pe=new ee;function ue(d){const e=this.getBoundingClientRect();ye.set(d.clientX-e.x,d.clientY-e.y)}function fe(d){const e=this.getBoundingClientRect();if(pe.set(d.clientX-e.x,d.clientY-e.y),ye.distanceTo(pe)>2)return;V===u.domElement?P.setFromCamera(S,w):P.setFromCamera(S,a.orthographic?b:m),P.firstHitOnly=!0;const i=P.intersectObject(l.group,!0);if(i.length){const t=i[0].object,s=l.getPluginByName("DEBUG_TILES_PLUGIN").getTileInformationFromActiveObject(t);let n="";for(const o in s){let r=s[o];typeof r=="number"&&(r=Math.floor(r*1e5)/1e5);let c=o;for(;c.length<20;)c+=" ";n+=`${c} : ${r}
`}console.log(n)}}function _e(){b.position.copy(m.position),b.rotation.copy(m.rotation);const d=m.position.distanceTo(D.target)/2;let e=window.innerWidth/window.innerHeight;a.showSecondView&&(e*=.5),b.left=-e*d,b.right=e*d,b.bottom=-d,b.top=d,b.near=m.near,b.far=m.far,b.updateProjectionMatrix()}function ve(){requestAnimationFrame(ve),l.errorTarget=a.errorTarget,l.displayActiveTiles=a.displayActiveTiles,l.maxDepth=a.maxDepth;const d=l.getPluginByName("DEBUG_TILES_PLUGIN");if(d.enabled=a.enableDebug,d.displayBoxBounds=a.displayBoxBounds,d.displayParentBounds=a.displayParentBounds,d.displaySphereBounds=a.displaySphereBounds,d.displayRegionBounds=a.displayRegionBounds,d.colorMode=parseFloat(a.colorMode),d.unlit=a.unlit,a.orthographic?(l.deleteCamera(m),l.setCamera(b),l.setResolutionFromRenderer(b,f)):(l.deleteCamera(b),l.setCamera(m),l.setResolutionFromRenderer(m,f)),a.showSecondView?(l.setCamera(w),l.setResolutionFromRenderer(w,u)):l.deleteCamera(w),l.root&&l.root.boundingVolume.region&&(l.getOrientedBoundingBox(W,T.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale),T.position.set(0,0,0),T.quaternion.invert(),T.scale.set(1,1,1)),A.rotation.set(0,0,0),a.up==="-Z"?A.rotation.x=Math.PI/2:a.up==="+Z"&&(A.rotation.x=-Math.PI/2),A.updateMatrixWorld(!1),l.getBoundingBox(W)?(W.getCenter(l.group.position),l.group.position.multiplyScalar(-1)):l.getBoundingSphere(J)&&(l.group.position.copy(J.center),l.group.position.multiplyScalar(-1)),parseFloat(a.raycast)!==me&&V!==null){V===f.domElement?P.setFromCamera(S,a.orthographic?b:m):P.setFromCamera(S,w),P.firstHitOnly=parseFloat(a.raycast)===be;const e=P.intersectObject(l.group,!0);if(e.length){const i=e[0],t=i.point;if(g.position.copy(t),i.face){const s=i.face.normal;s.transformDirection(i.object.matrixWorld),g.lookAt(t.x+s.x,t.y+s.y,t.z+s.z)}g.visible=!0}else g.visible=!1}else g.visible=!1;window.tiles=l,a.enableUpdate&&(w.updateMatrixWorld(),m.updateMatrixWorld(),b.updateMatrixWorld(),l.update()),et(),G.update()}function et(){if(_e(),U.visible=!1,K.visible=!1,H.visible=!1,a.orthographic){const i=b.position.distanceTo(g.position);g.scale.setScalar(i/150)}else{const i=m.position.distanceTo(g.position);g.scale.setScalar(i*m.fov/6e3)}if(f.render(C,a.orthographic?b:m),a.showSecondView){const i=w.position.distanceTo(g.position);g.scale.setScalar(i*w.fov/6e3),u.render(C,w)}if(x.domElement.style.visibility=a.showThirdPerson?"visible":"hidden",a.showThirdPerson){U.update(),U.visible=!a.orthographic,K.update(),K.visible=a.orthographic,a.showSecondView&&(H.update(),H.visible=!0);const i=B.position.distanceTo(g.position);g.scale.setScalar(i*B.fov/6e3),x.render(C,B)}const d=l.lruCache.itemList.length/l.lruCache.maxSize;let e=`Downloading: ${l.stats.downloading} Parsing: ${l.stats.parsing} Visible: ${l.visibleTiles.size}`;if(a.enableCacheDisplay){const i=new Set;l.traverse(s=>{const n=s.cached.scene;n&&n.traverse(o=>{o.geometry&&i.add(o.geometry)})});let t=0;i.forEach(s=>{t+=Oe(s)}),e+=`<br/>Cache: ${(100*d).toFixed(2)}% ~${(t/1e3/1e3).toFixed(2)}mb`}if(a.enableRendererStats){const i=f.info.memory,t=f.info.programs.length;e+=`<br/>Geometries: ${i.geometries} Textures: ${i.textures} Programs: ${t}`}v.innerHTML!==e&&(v.innerHTML=e)}
//# sourceMappingURL=index-BQonMu2i.js.map
